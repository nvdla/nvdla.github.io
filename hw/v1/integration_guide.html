
<!DOCTYPE html>

<html>
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Integrator’s Manual &#8212; NVDLA Documentation</title>
    <link rel="stylesheet" href="../../_static/pygments.css" type="text/css" />
    <link rel="stylesheet" href="../../_static/nvdla.css" type="text/css" />
    <link rel="stylesheet" type="text/css" href="../../_static/styles.css" />
    <script id="documentation_options" data-url_root="../../" src="../../_static/documentation_options.js"></script>
    <script src="../../_static/jquery.js"></script>
    <script src="../../_static/underscore.js"></script>
    <script src="../../_static/doctools.js"></script>
    <link rel="search" title="Search" href="../../search.html" />
    <link rel="next" title="Precision Preservation" href="ias/precision.html" />
    <link rel="prev" title="In-memory data formats" href="../format.html" />
 
<script src="//assets.adobedtm.com/b92787824f2e0e9b68dc2e993f9bd995339fe417/satelliteLib-30c8ffcc8ece089156fd5590fbcf390ffc296f51.js"></script>
  </head><body>
<header class="navbar">
  <nav class="container navbar navbar-light bg-faded">
    <a class="navbar-brand" href="https://www.nvidia.com/">
      <div class="logo"></div>
    </a>
  </nav>
</header>

    <div class="related" role="navigation" aria-label="related navigation">
      <div class="container">
      <div class="row">
      <h3>Navigation</h3>
      <ul>
        <li class="right first">
          <a href="ias/precision.html" title="Precision Preservation"
             accesskey="N">next</a></li>
        <li class="right">
          <a href="../format.html" title="In-memory data formats"
             accesskey="P">previous</a> |</li>
        <li class="nav-item nav-item-0"><a href="../../index.html">NVDLA Open Source Project</a>&#187;</li>
        <li class="nav-item nav-item-1"><a href="../../contents.html">Documentation</a>&#187;</li>
          <li class="nav-item nav-item-2"><a href="../contents.html" accesskey="U">Hardware Manual</a>&#187;</li> 
      </ul>
      </div>
      </div>
    </div>
  <div class="document">
    <div class="container">
      <div class="row">
        <div class="col-xs-12 col-md-9">
          
  <div class="section" id="integrator-s-manual">
<h1>Integrator’s Manual<a class="headerlink" href="#integrator-s-manual" title="Permalink to this headline">¶</a></h1>
<div class="section" id="introduction">
<h2>Introduction<a class="headerlink" href="#introduction" title="Permalink to this headline">¶</a></h2>
<p>This document introduces essential knowledge for how to integrate NVDLA into
an SoC.  It includes detail on bus interfaces, power on sequence, address
map, cell requirements, testbench, and synthesis.</p>
<p>The open source repository contains the NVDLA design RTL, a testbench with
a set of sanity tests, a performance estimation spreadheet, and a set of
synthesis scripts.</p>
</div>
<div class="section" id="quick-start">
<h2>Quick-Start<a class="headerlink" href="#quick-start" title="Permalink to this headline">¶</a></h2>
<p>After downloading, to understand more about the NVDLA design, you can try out the following:</p>
<ol class="arabic simple">
<li><p>Set up the Linux environment with required tools.  Review <a class="reference internal" href="#env-setup"><span class="std std-ref">Environment Setup</span></a></p></li>
<li><p>Select a configuration and build the hardware tree.  Review <a class="reference internal" href="#tree-build"><span class="std std-ref">Tree Build</span></a></p></li>
<li><p>Run a simulation using the included testbench.  A number of sanity
tests are included in the repository.  See <a class="reference internal" href="#simulation-testbench"><span class="std std-ref">Reference Simulation Testbench</span></a></p></li>
<li><p>Synthesize the design to review area and timing in your
library.  See <a class="reference internal" href="#synthesis"><span class="std std-ref">Synthesis</span></a>.  You will need to map RAM’s
to your RAM library.  See <a class="reference internal" href="#memories-sram"><span class="std std-ref">Memories (SRAM)</span></a>.  And update timing contraints
as appropriate for your technology.</p></li>
<li><p>Open up the <a class="reference internal" href="#performance-model"><span class="std std-ref">Performance Model</span></a> spreadsheet to look at
performance with different NVDLA configurations.  Configurable RTL
is on the <a class="reference internal" href="../../roadmap.html"><span class="doc">Open Source Roadmap</span></a>.</p></li>
<li><p>Integrate the NVDLA RTL into your SoC.  The sanity tests that are run in the stand-alone NVDLA
testbench can also be run at the SoC level and used to validate the integration.
See <a class="reference internal" href="#test-format"><span class="std std-ref">Test Format</span></a>.</p></li>
</ol>
</div>
<div class="section" id="hardware-system-interface">
<h2>Hardware System Interface<a class="headerlink" href="#hardware-system-interface" title="Permalink to this headline">¶</a></h2>
<div class="section" id="overview">
<h3>Overview<a class="headerlink" href="#overview" title="Permalink to this headline">¶</a></h3>
<p>NVDLA is a fixed function accelerator engine which is targeted towards deep
learning.  This section introduces the NVDLA external interface and
recommended connections.</p>
</div>
<div class="section" id="system-diagram">
<h3>System Diagram<a class="headerlink" href="#system-diagram" title="Permalink to this headline">¶</a></h3>
<p>The following diagram shows the NVDLA connections to an SoC.</p>
<div class="figure align-center" id="fig-system-interfaces">
<a class="reference internal image-reference" href="../../_images/ig_system_interfaces.png"><img alt="System Interface Diagram" src="../../_images/ig_system_interfaces.png" style="width: 538.0px; height: 259.5px;" /></a>
</div>
<p>NVDLA receives commands from the host processor via the CSB interface.  The two
independent memory interfaces provide access to storage for
data feeding NVDLA and output data from NVDLA.  The interrupt provides a notification
to a controlling CPU that NVDLA has completed a task.</p>
</div>
<div class="section" id="interfaces">
<h3>Interfaces<a class="headerlink" href="#interfaces" title="Permalink to this headline">¶</a></h3>
<p>NVDLA’s external pins are grouped into the following interfaces:</p>
<ol class="arabic simple">
<li><p>Clock and Reset interface</p></li>
<li><p>System Data interface</p></li>
<li><p>Configure interface</p></li>
<li><p>Interrupt interface</p></li>
<li><p>Power control</p></li>
<li><p>DFT interface</p></li>
</ol>
<div class="section" id="clock-and-reset-interface">
<h4>Clock and reset interface<a class="headerlink" href="#clock-and-reset-interface" title="Permalink to this headline">¶</a></h4>
<p>There are two clock domains in NVDLA, dla_core_clk and dla_csb_clk. They are
asynchronous with respect to each other, and have no required frequency relationship.
Most of the sub-units
are in dla_core_clk domain. The Csb_master sub-unit which translates configuration
commands from host clock domain to dla_core_clk domain. To reduce power consumptions,
clock gating technology has been deployed in NVDLA.</p>
<p>The main reset signal of NVDLA is dla_reset_rstn. Internal to NVDLA it’s synchronized to
one of the two clock domains before use.  The NVDLA design utilizaes asynchronous reset
flops, so only the deassertion edge of the dla_reset_rstn signal is synchronized.  The
assertion edge is passed through.
The other reset signal, direct_reset_, is
useful for ATPG testing since it bypasses the internal synchronization.</p>
<table class="colwidths-given docutils align-default" id="id8">
<caption><span class="caption-number">Table 36 </span><span class="caption-text">Clock and Reset Signals</span><a class="headerlink" href="#id8" title="Permalink to this table">¶</a></caption>
<colgroup>
<col style="width: 20%" />
<col style="width: 40%" />
<col style="width: 40%" />
</colgroup>
<thead>
<tr class="row-odd"><th class="head"><p>Signal Name</p></th>
<th class="head"><p>Description</p></th>
<th class="head"><p>Recommended Connection</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p>dla_core_clk</p></td>
<td><p>Functional clock for NVDLA</p></td>
<td><p>Always ticking clock</p></td>
</tr>
<tr class="row-odd"><td><p>dla_csb_clk</p></td>
<td><p>CSB bus clock for NVDLA configuration, same clock domain as host</p></td>
<td><p>Clock of the configurable interface</p></td>
</tr>
<tr class="row-even"><td><p>global_clk_ovr_on</p></td>
<td><p>Can be used to disable all non-inferred clock gates.  Typically not used.</p></td>
<td><p>Connect to a register in system controller which is reset to 0.
You can also tie to low.</p></td>
</tr>
<tr class="row-odd"><td><p>tmc2slcg_disable_clock_gating</p></td>
<td><p>Disable clock gating during DFT operations.</p></td>
<td><p>Connect system DFT controller, should be 0 in normal function mode.</p></td>
</tr>
<tr class="row-even"><td><p>direct_reset_</p></td>
<td><p>DFT reset to allow for direct reset controllability during ATPG testing.</p></td>
<td><p>Typically routed to a chip level port.</p></td>
</tr>
<tr class="row-odd"><td><p>dla_reset_rstn</p></td>
<td><p>Main functional reset for DLA block.</p></td>
<td><p>System reset controller, can be hard-wired control logic or connect to register if SW reset is desired.</p></td>
</tr>
</tbody>
</table>
</div>
<div class="section" id="system-data-interfaces-dbbif-and-sramif">
<h4>System Data Interfaces (DBBIF and SRAMIF)<a class="headerlink" href="#system-data-interfaces-dbbif-and-sramif" title="Permalink to this headline">¶</a></h4>
<p>NVDLA accesses external data through two data master interfaces: DBBIF and SRAMIF
In the RTL these are are sometimes referred to as dbb and cvsram.  Later version will
likely all references to dbbif and sramif.
DBBIF typically is connected to off chip DRAM and provides high bandwidth with longer latency. SRAMIF
is typically connected to an on-chip SRAM and provides high bandwidth with low.
In current release the bus interfaces are designed to run optimally with max latency on DBBIF of up to
1440 cycles and an SRAMIF latency of up to 128 cycles.
To support the two different memory subsystem characteristics there are some minor difference in
implementation between the NVDLA’s bus interface logic between DBBIF and SRAMIF.</p>
<p>More information on the DBBIF and SRAMIF interfaces, including signal naming, can be found
in the NVDLA Hardware Architecture Guide.</p>
</div>
<div class="section" id="configuration-interface">
<h4>Configuration Interface<a class="headerlink" href="#configuration-interface" title="Permalink to this headline">¶</a></h4>
<p>The host uses the CSB (Config Space Bus) interface to access NVDLA registers. Each request to
CSB has a fixed request size of 32 bits of data, and has a fixed 16-bit address size.
CSB does not support any form of burst requests; each packet sent down the request channel
is independent from any other packet.</p>
<p>A detailed interface description of the configuration interface can be found in NVDLA Architecture document.</p>
</div>
<div class="section" id="power-control">
<h4>Power control<a class="headerlink" href="#power-control" title="Permalink to this headline">¶</a></h4>
<p>Depending on the target library the RAM cells in NVDLA could be gated to reduce power
consumption when NVDLA is inactive. Each layout partition has one ram power control bus, allowing
power to be ramped up/down one or more partitions at a time.  If a user is using RAM cells
without power controls, those signals can be tied to 0.</p>
<table class="colwidths-given docutils align-default" id="id9">
<caption><span class="caption-number">Table 37 </span><span class="caption-text">Power Control Signals</span><a class="headerlink" href="#id9" title="Permalink to this table">¶</a></caption>
<colgroup>
<col style="width: 20%" />
<col style="width: 40%" />
<col style="width: 40%" />
</colgroup>
<thead>
<tr class="row-odd"><th class="head"><p>Signal Name</p></th>
<th class="head"><p>Description</p></th>
<th class="head"><p>Recommended Connection</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p>nvdla_pwrbus_ram_*_pd[7:0]</p></td>
<td><p>RAM power gate.  These signals are routed to the SLEEP_EN bus on the RAM macro wrappers.
They can be used for controlling low power modes of the target RAMs.</p></td>
<td><p>SoC power management unit or tie to 0</p></td>
</tr>
<tr class="row-odd"><td><p>nvdla_pwrbus_ram_*_pd[8]</p></td>
<td><p>RAM retention control.  This signal is routed to the RET_EN signal on the RAM macro wrappers.
It can be used for controlling retention control, or any other semi-static RAM configuration bit.</p></td>
<td><p>SoC power management unit or tie to 0</p></td>
</tr>
<tr class="row-even"><td><p>nvdla_pwrbus_ram_*_pd[31:9]</p></td>
<td><p>Not used</p></td>
<td><p>Tie to 0</p></td>
</tr>
</tbody>
</table>
</div>
<div class="section" id="dft">
<h4>DFT<a class="headerlink" href="#dft" title="Permalink to this headline">¶</a></h4>
<p>In current release, NVDLA has implemented one signal named test_mode to enable DFT.</p>
<table class="colwidths-given docutils align-default" id="id10">
<caption><span class="caption-number">Table 38 </span><span class="caption-text">DFT Signals</span><a class="headerlink" href="#id10" title="Permalink to this table">¶</a></caption>
<colgroup>
<col style="width: 20%" />
<col style="width: 40%" />
<col style="width: 40%" />
</colgroup>
<thead>
<tr class="row-odd"><th class="head"><p>Signal Name</p></th>
<th class="head"><p>Description</p></th>
<th class="head"><p>Recommended Connection</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p>test_mode</p></td>
<td><p>Enable test mode.  The only use of this signal currently is to select between
the functional and DFT reset signals.</p></td>
<td><p>Should connect to the system DFT controller as needed.  Otherwise, tie to 0.</p></td>
</tr>
</tbody>
</table>
</div>
</div>
</div>
<div class="section" id="environment-setup">
<span id="env-setup"></span><h2>Environment Setup<a class="headerlink" href="#environment-setup" title="Permalink to this headline">¶</a></h2>
<p>The Verilog code included in this release is parameterized such that multiple configurations
can be generated from a single source.  A hardware tree build is needed to generate the final
Verilog RTL code for a given configuration.  The tools required for this build are outlined
below.  The versions listed are used for testing.</p>
<ul class="simple">
<li><p>Java - jdk1.7</p></li>
<li><dl class="simple">
<dt>Perl - perl-5.10</dt><dd><ul>
<li><p>XML::Simple</p></li>
<li><p>Capture::Tiny</p></li>
</ul>
</dd>
</dl>
</li>
<li><p>CPP - gcc-4.9.3</p></li>
<li><p>Python - python2.6</p></li>
<li><p>SystemC - systemc-2.3.0</p></li>
<li><p>(for Verilator builds) Verilator - Verilator 3.912</p></li>
<li><p>(for Verilator builds) clang - clang 3.4</p></li>
</ul>
<div class="admonition warning">
<p class="admonition-title">Warning</p>
<p>NVDLA requires the exact SystemC version specified (2.3.0).  Despite the
subminor version change, 2.3.1 and 2.3.2 have compatibility issues with
NVDLA, including issues with hierarchical binding, and the NVDLA Cmodel
will fail at runtime when compiled with those versions.</p>
</div>
</div>
<div class="section" id="tree-build">
<span id="id1"></span><h2>Tree Build<a class="headerlink" href="#tree-build" title="Permalink to this headline">¶</a></h2>
<p>The NVDLA repository supports the build of multiple configurations based on a feature
specification file.  Each configuration of the NVDLA is defined by a spec file in
he hw/spec/defs directory.  The filename is the name of the configuration with a “.spec”
extension.  For the configurable release, there are currently two spec files included: “nv_large” which has 2048 INT8 MAC’s,
and “nv_small” which has 64 INT8 MAC’s plus some other reductions; the non-configurable
release has a single spec file, “nv_full”, which has 2048 multi-precision MAC units.</p>
<p>The file hw/tree.make specifies a list of configurations to build, as well as paths to tools
required for building the configured RTL.  To create an initial version of this file, run the
following command:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">cd</span> <span class="n">hw</span>
<span class="n">make</span>
</pre></div>
</div>
<p>This command will prompt for the configuration and tool locations.  It will create a tree.make
file in the hw directory containing the appropriate configuration and tool setup.
For subsequent changes the tree.make file can be edited directly with a text editor.  Once
tree.make setup is complete, the RTL can be built:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">cd</span> <span class="n">hw</span>
<span class="o">./</span><span class="n">tools</span><span class="o">/</span><span class="nb">bin</span><span class="o">/</span><span class="n">tmake</span> <span class="o">-</span><span class="n">build</span> <span class="n">vmod</span>
</pre></div>
</div>
<p>The tmake program can also be used to launch a set of short sanity simulations.  Once you’ve
set up the simulation environment according to the testbench section of this
document <a class="reference internal" href="#testbench"><span class="std std-ref">Testbench &amp; Traces</span></a>, the following command can be used to launch the short sanity
regression:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="o">./</span><span class="n">tools</span><span class="o">/</span><span class="nb">bin</span><span class="o">/</span><span class="n">tmake</span> <span class="o">-</span><span class="n">build</span> <span class="n">verif_sim</span>
</pre></div>
</div>
<p>Additionally, there is a tmake target for the Cmodel of NVDLA, which lives
in the <code class="docutils literal notranslate"><span class="pre">cmod/</span></code> directory.  If building the Virtual Platform, or another
application that uses the NVDLA Cmodel, the following command will build it
and install it into <code class="docutils literal notranslate"><span class="pre">outdir/nv_full/cmod/release</span></code>:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="o">./</span><span class="n">tools</span><span class="o">/</span><span class="nb">bin</span><span class="o">/</span><span class="n">tmake</span> <span class="o">-</span><span class="n">build</span> <span class="n">cmod_top</span>
</pre></div>
</div>
<div class="section" id="version-control-usage">
<h3>Version control usage<a class="headerlink" href="#version-control-usage" title="Permalink to this headline">¶</a></h3>
<p>NVDLA is developed in Git, on multiple branches.  It is important to use the
correct branch to track the development work that is desired.  Currently,
the following two branches exist:</p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">nvdlav1</span></code>: This is the default branch for any new clones of the NVDLA
repository from November 21st, 2017, on.  The <code class="docutils literal notranslate"><span class="pre">nvdlav1</span></code> branch contains
sustaining support work around the non-configurable, full-precision
version of NVDLAv1 (“nv_full”).  New RTL features will not be added to the
<code class="docutils literal notranslate"><span class="pre">nvdlav1</span></code> branch, though bug fixes may appear, as may new verification
features.  Users who desire a stable version of NVDLA may prefer to choose
the <code class="docutils literal notranslate"><span class="pre">nvdlav1</span></code> branch.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">master</span></code>: This branch contains ongoing development work on the NVDLA
RTL, including work towards multiple configurations and additional feature
development.  This branch is expected to pass “sanity” tests, but may not
always be tapeout-quality.  Infrastructure in this branch may change
rapidly.  Users who desire the most up-to-date view of NVDLA development
may prefer to choose the <code class="docutils literal notranslate"><span class="pre">master</span></code> branch.  The <code class="docutils literal notranslate"><span class="pre">master</span></code> branch was the
default for clones made before November 21st, 2017.</p></li>
</ul>
<p>Note that the <code class="docutils literal notranslate"><span class="pre">nvdlav1</span></code> branch’s history will diverge from the <code class="docutils literal notranslate"><span class="pre">master</span></code>
branch; the <code class="docutils literal notranslate"><span class="pre">master</span></code> branch will not be a strict superset of the
<code class="docutils literal notranslate"><span class="pre">nvdlav1</span></code> branch.</p>
</div>
</div>
<div class="section" id="performance-model">
<span id="id2"></span><h2>Performance Model<a class="headerlink" href="#performance-model" title="Permalink to this headline">¶</a></h2>
<p>Included in the repository is a spreadsheet based performance model.  This spreadsheet models the
performance for three popular convolutional networks: AlexNet, GoogleNet, and ResNet50.  Additional
networks could be added by following the structure of the three provided.  Performance calculated
is ideal performance as it doesn’t account for some software overhead.  The spreadsheet is located
in the repository at hw/perf/DLA_OpenSource_Performance.xlsx.  The first tab in the spreadsheet, named
“Readme”, describes how the model works.  It calculates the following metrics.</p>
<ul class="simple">
<li><p>Average run time for a frame</p></li>
<li><p>Frames per second</p></li>
<li><p>Hardware MAC utilization</p></li>
<li><p>Network MAC utilization</p></li>
</ul>
<p>The tool can be used to look at the easyffect of different hardware configurations on network performance.</p>
</div>
<div class="section" id="designware-components">
<h2>Designware Components<a class="headerlink" href="#designware-components" title="Permalink to this headline">¶</a></h2>
<p>The NVDLA design utilize the following Designware components.</p>
<ul class="simple">
<li><p>DW02_tree</p></li>
<li><p>DW_lsd</p></li>
<li><p>DW_minmax</p></li>
</ul>
<p>For best QOR, the EDA vendor supplied versions should be used for both synthesis
and simulation if possible.  They can be obtained directly from the EDA vendors.</p>
<p>If no designware implementation is available, the NVDLA repository contains
an implementation with an NV_ prefix to the filename and module name.
These files are in the hw/vlib directory.  The design can be switched to
using the NV_ version of the files by setting the Verilog define macro
DESIGNWARE_NOEXIST to 1; similarly, the environment variable
DESIGNWARE_NOEXIST will enable this in the simulation build environment.
However, these NV_ versions should not be used currently for any tapeout.</p>
<div class="admonition warning">
<p class="admonition-title">Warning</p>
<p>Be careful to set the DESIGNWARE_NOEXIST variable the same way for
simulation as for synthesis.  The NV_ variations are believed to be
correct, but are not verified to the same degree as DesignWare components
are; simulating different RTL than is synthesized can result in unexpected
defects in a tapeout netlist.</p>
</div>
</div>
<div class="section" id="library-cells">
<h2>Library Cells<a class="headerlink" href="#library-cells" title="Permalink to this headline">¶</a></h2>
<p>There are a few library cells which the NVDLA design requires.  These cells are instantiated
by the design, but only behavioral models are provided.  The integrator will need to provide
a mapping to a technology library.  Typically, the effort would be to create a Verilog
wrapper module which has the same ports as the RTL version provided in the release, and
which instantiates a standard cell or memory from a local library.</p>
<div class="section" id="synchronizers">
<h3>Synchronizers<a class="headerlink" href="#synchronizers" title="Permalink to this headline">¶</a></h3>
<p>The NVDLA design instantes four types of clock domain crossing synchronizers.  These cells
are modelled with RTL Verilog so they are synthesizable.  However, like all synchronizers,
they should be replaced with a standard cell designed to reduce MTBF.  To replace, the
RTL impelemtnation of the cells below can be removed (keeping the port list), and replaced
with an instantiation of a standard cell synchronizer as appropriate.</p>
<ul>
<li><p>p_SSYNC2DO_C_PP</p>
<p>Two flop stage deep synchronizer with an active low asynchronous reset/clear pin.</p>
</li>
<li><p>p_SSYNC3DO</p>
<p>Three flop stage deep synchronizer.</p>
</li>
<li><p>p_SSYNC3DO_C_PPP</p>
<p>Three flop stage deep synchronizer with an active low asynchronous reset/clear pin.</p>
</li>
<li><p>p_SSYNC3DO_S_PPP</p>
<p>Three flop stage deep synchronizer with an active low asynchronous set pin.</p>
</li>
</ul>
</div>
<div class="section" id="memories-sram">
<span id="id3"></span><h3>Memories (SRAM)<a class="headerlink" href="#memories-sram" title="Permalink to this headline">¶</a></h3>
<p>The memories instantiated in the NVDLA design have a logical interface which is fairly common
across RAM compilers.  The release contains a behavioral model for these RAMS which can be
used for simulation.  For synthesis, these behavioral models will need to be replaced with
a Verilog wrapper which maps to RAM cells from a local library.</p>
<p>All functionality for a RAM can be inferred from the RAM name:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">RAM</span><span class="o">&lt;</span><span class="n">Arch</span><span class="o">&gt;</span><span class="n">_</span><span class="o">&lt;</span><span class="n">Depth</span><span class="o">&gt;</span><span class="n">X</span><span class="o">&lt;</span><span class="n">Width</span><span class="o">&gt;</span><span class="p">[</span><span class="n">_Options</span><span class="p">]</span><span class="o">&lt;</span><span class="n">_Mux</span><span class="o">-</span><span class="n">Option</span><span class="o">&gt;</span><span class="n">_</span><span class="o">&lt;</span><span class="n">Rev</span><span class="o">&gt;</span>

<span class="n">Arch</span>        <span class="n">required</span><span class="p">,</span> <span class="n">physical</span> <span class="n">implementation</span> <span class="n">of</span> <span class="n">the</span> <span class="n">cell</span><span class="p">:</span>
              <span class="o">-</span><span class="n">PDP</span>  <span class="n">pseudo</span><span class="o">-</span><span class="n">dual</span> <span class="n">port</span> <span class="n">SRAM</span><span class="o">.</span>  <span class="n">Created</span> <span class="n">by</span> <span class="n">double</span> <span class="n">clocking</span>
                    <span class="n">a</span> <span class="n">single</span> <span class="n">port</span> <span class="n">RAM</span><span class="o">.</span>
              <span class="o">-</span><span class="n">DP</span>   <span class="n">true</span> <span class="n">dual</span> <span class="n">port</span> <span class="n">SRAM</span><span class="o">.</span>  <span class="n">Always</span> <span class="n">has</span> <span class="n">independent</span> <span class="n">read</span>
                    <span class="ow">and</span> <span class="n">write</span> <span class="n">ports</span><span class="o">.</span>
<span class="n">Depth</span>       <span class="n">required</span><span class="p">,</span> <span class="n">number</span> <span class="n">of</span> <span class="n">words</span> <span class="ow">in</span> <span class="n">the</span> <span class="n">RAM</span>
<span class="n">Width</span>       <span class="n">required</span><span class="p">,</span> <span class="n">number</span> <span class="n">of</span> <span class="n">bits</span> <span class="ow">in</span> <span class="n">the</span> <span class="n">RAM</span>
<span class="n">Options</span>     <span class="n">GL</span> <span class="k">for</span> <span class="nb">all</span> <span class="n">RAMs</span>
<span class="n">Mux</span><span class="o">-</span><span class="n">Option</span>  <span class="n">Required</span><span class="p">,</span> <span class="n">fixed</span> <span class="n">width</span> <span class="n">field</span> <span class="n">describing</span> <span class="n">column</span> <span class="n">mux</span> <span class="n">options</span>
              <span class="o">-</span> <span class="n">Mn</span>  <span class="n">Column</span> <span class="n">mux</span> <span class="n">specification</span><span class="o">.</span>
<span class="n">Rev</span>         <span class="n">Revision</span><span class="p">:</span> <span class="n">E2</span> <span class="k">for</span> <span class="n">DP</span> <span class="n">RAMS</span><span class="p">,</span> <span class="n">D2</span> <span class="k">for</span> <span class="n">PDP</span> <span class="n">RAMs</span>
</pre></div>
</div>
<div class="section" id="ramdp-dual-port-sram">
<h4>RAMDP: Dual-Port SRAM<a class="headerlink" href="#ramdp-dual-port-sram" title="Permalink to this headline">¶</a></h4>
<p>This section describes a dual-port SRAM design. The macro is designed to perform
read and write operations independently.</p>
<table class="docutils align-default">
<colgroup>
<col style="width: 25%" />
<col style="width: 23%" />
<col style="width: 15%" />
<col style="width: 38%" />
</colgroup>
<thead>
<tr class="row-odd"><th class="head"><p>Pin</p></th>
<th class="head"><p>Type</p></th>
<th class="head"><p>Presence</p></th>
<th class="head"><p>Description</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td colspan="4"><p>Read/Write Pins</p></td>
</tr>
<tr class="row-odd"><td><p>CLK_R</p></td>
<td><p>Input; Clock</p></td>
<td><p>Default</p></td>
<td><p>Memory read clock</p></td>
</tr>
<tr class="row-even"><td><p>CLK_W</p></td>
<td><p>Input; Clock</p></td>
<td><p>Default</p></td>
<td><p>Memory write clock</p></td>
</tr>
<tr class="row-odd"><td><p>RADR_[msb:0]</p></td>
<td><p>Input</p></td>
<td><p>Default</p></td>
<td><p>Synchronous read
address input</p></td>
</tr>
<tr class="row-even"><td><p>RD_[msb:0]</p></td>
<td><p>Output</p></td>
<td><p>Default</p></td>
<td><p>Memory read data
output</p></td>
</tr>
<tr class="row-odd"><td><p>RE</p></td>
<td><p>Input</p></td>
<td><p>Default</p></td>
<td><p>Synchronous read
enable</p></td>
</tr>
<tr class="row-even"><td><p>WADR_[msb:0]</p></td>
<td><p>Input</p></td>
<td><p>Default</p></td>
<td><p>Synchronous write
address input</p></td>
</tr>
<tr class="row-odd"><td><p>WD_[msb:0]</p></td>
<td><p>Input</p></td>
<td><p>Default</p></td>
<td><p>Synchronous write
data input</p></td>
</tr>
<tr class="row-even"><td><p>WE</p></td>
<td><p>Input</p></td>
<td><p>Default</p></td>
<td><p>Synchronous write
enable</p></td>
</tr>
<tr class="row-odd"><td colspan="4"><p>Misc. Pins.  These will depend on the target RAM library for
whether they’re necessary.</p></td>
</tr>
<tr class="row-even"><td><p>IDDQ</p></td>
<td><p>Input</p></td>
<td><p>Default</p></td>
<td><p>Asynchronous stand-by
mode enable pin</p></td>
</tr>
<tr class="row-odd"><td><p>SLEEP_EN_[7:0]</p></td>
<td><p>Input</p></td>
<td><p>Default</p></td>
<td><p>Power gating controls</p></td>
</tr>
<tr class="row-even"><td><p>RET_EN</p></td>
<td><p>Input</p></td>
<td><p>Default</p></td>
<td><p>Retention enable</p></td>
</tr>
<tr class="row-odd"><td><p>RET_SVOP[1:0]</p></td>
<td><p>Input</p></td>
<td><p>Default</p></td>
<td><p>Timing margin control
pins</p></td>
</tr>
</tbody>
</table>
<div class="line-block">
<div class="line"><br /></div>
</div>
<p>RAMDP is a true dual port high density SRAM, which allows read and write to operate at the same time.</p>
<p>All write operations are synchronized to the rising edge of write memory clock, CLK_W. The SRAM core is written when WE = ‘1’.</p>
<p>Read operation is synchronized to the rising edge of the read memory clock, CLK_R.  The SRAM core is read when RE = ‘1’.
A latch holds the read data whenever RE = ‘0’. There is no write through capability.
If the read address matches the write address, read out data may be corrupted.</p>
<div class="figure align-center" id="id11">
<span id="fig-ram-dp-read-timing"></span><a class="reference internal image-reference" href="../../_images/ig_sram_dp_read_timing.png"><img alt="Dual Port RAM Read Timing" src="../../_images/ig_sram_dp_read_timing.png" style="width: 706.0px; height: 354.0px;" /></a>
<p class="caption"><span class="caption-number">Fig. 28 </span><span class="caption-text">Dual Port RAM Read Timing</span><a class="headerlink" href="#id11" title="Permalink to this image">¶</a></p>
</div>
<div class="figure align-center" id="id12">
<span id="fig-ram-dp-write-timing"></span><a class="reference internal image-reference" href="../../_images/ig_sram_dp_write_timing.png"><img alt="Dual Port RAM Write Timing" src="../../_images/ig_sram_dp_write_timing.png" style="width: 671.0px; height: 372.5px;" /></a>
<p class="caption"><span class="caption-number">Fig. 29 </span><span class="caption-text">Dual Port RAM Write Timing</span><a class="headerlink" href="#id12" title="Permalink to this image">¶</a></p>
</div>
<div class="line-block">
<div class="line"><br /></div>
<div class="line"><br /></div>
<div class="line"><br /></div>
</div>
</div>
<div class="section" id="rampdp-pseudo-dual-port-sram">
<h4>RAMPDP: Pseudo-Dual Port SRAM<a class="headerlink" href="#rampdp-pseudo-dual-port-sram" title="Permalink to this headline">¶</a></h4>
<p>This section describes an embedded pseudo-dual port SRAM macro. The RAMPDP macro behaves like a dual
port RAM, but is created by double clocking a single port RAM.</p>
<p>The following enumerates the RAMPDP pins and corresponding functions.</p>
<p>Note that:
* All pin power is referenced to VDD.
* All enables are active high.</p>
<table class="docutils align-default">
<colgroup>
<col style="width: 25%" />
<col style="width: 23%" />
<col style="width: 15%" />
<col style="width: 38%" />
</colgroup>
<thead>
<tr class="row-odd"><th class="head"><p>Pin</p></th>
<th class="head"><p>Type</p></th>
<th class="head"><p>Presence</p></th>
<th class="head"><p>Description</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td colspan="4"><p>Read/Write Pins</p></td>
</tr>
<tr class="row-odd"><td><p>CLK</p></td>
<td><p>Input; Clock</p></td>
<td><p>Default</p></td>
<td><p>Memory clock</p></td>
</tr>
<tr class="row-even"><td><p>RADR_[msb:0]</p></td>
<td><p>Input</p></td>
<td><p>Default</p></td>
<td><p>Synchronous read
address input</p></td>
</tr>
<tr class="row-odd"><td><p>RD_[msb:0]</p></td>
<td><p>Output</p></td>
<td><p>Default</p></td>
<td><p>Memory read data
output</p></td>
</tr>
<tr class="row-even"><td><p>RE</p></td>
<td><p>Input</p></td>
<td><p>Default</p></td>
<td><p>Synchronous read
enable</p></td>
</tr>
<tr class="row-odd"><td><p>WADR_[msb:0]</p></td>
<td><p>Input</p></td>
<td><p>Default</p></td>
<td><p>Synchronous write
address input</p></td>
</tr>
<tr class="row-even"><td><p>WD_[msb:0]</p></td>
<td><p>Input</p></td>
<td><p>Default</p></td>
<td><p>Synchronous write
data input</p></td>
</tr>
<tr class="row-odd"><td><p>WE</p></td>
<td><p>Input</p></td>
<td><p>Default</p></td>
<td><p>Synchronous write
enable</p></td>
</tr>
<tr class="row-even"><td colspan="4"><p>Misc. Pins.  These will depend on the target RAM library for
whether they are necessary.</p></td>
</tr>
<tr class="row-odd"><td><p>IDDQ</p></td>
<td><p>Input</p></td>
<td><p>Default</p></td>
<td><p>Asynchronous stand-by
mode enable pin</p></td>
</tr>
<tr class="row-even"><td><p>SLEEP_EN_[7:0]</p></td>
<td><p>Input</p></td>
<td><p>Default</p></td>
<td><p>Power gating controls</p></td>
</tr>
<tr class="row-odd"><td><p>RET_EN</p></td>
<td><p>Input</p></td>
<td><p>Default</p></td>
<td><p>Retention enable</p></td>
</tr>
<tr class="row-even"><td><p>RET_SVOP[1:0]</p></td>
<td><p>Input</p></td>
<td><p>Default</p></td>
<td><p>Timing margin control
pins</p></td>
</tr>
</tbody>
</table>
<div class="figure align-center" id="id13">
<span id="fig-ram-pdp-timing"></span><a class="reference internal image-reference" href="../../_images/ig_sram_pdp_timing.png"><img alt="Pseudo Dual Port RAM Timing" src="../../_images/ig_sram_pdp_timing.png" style="width: 748.0px; height: 473.0px;" /></a>
<p class="caption"><span class="caption-number">Fig. 30 </span><span class="caption-text">Pseudo Dual Port RAM Timing</span><a class="headerlink" href="#id13" title="Permalink to this image">¶</a></p>
</div>
<p>The RAMPDP behaves like a dual port RAM, but is created by double clocking a single port RAM.
It can perform a ‘single read’ (1R), a ‘single write’ (1W) or a ‘read followed by write’ (1R+1W)
operation in any given clock cycle.
A read operation is performed when the signal RE is active high (RE= ‘1’). The output data
will be driven to the output port RD in the same cycle read commands are issued.
A latch holds the read data when ‘RE’=0. A write operation is performed when WE is high (WE= ‘1’).
The input data must be put on the input data bus WD at the same time with the write command.
Note that if the read and write address match during a (1R+1W) operation, i.e. RE=WE=’1’, the
read data will contain the previous contents of the RAM (read occurs before write).</p>
</div>
</div>
</div>
<div class="section" id="synthesis">
<span id="id4"></span><h2>Synthesis<a class="headerlink" href="#synthesis" title="Permalink to this headline">¶</a></h2>
<div class="section" id="id5">
<h3>Overview<a class="headerlink" href="#id5" title="Permalink to this headline">¶</a></h3>
<p>This release contains reference synthesis setup for the NVDLA design with Design Compiler (Wireload Model/Topographical).</p>
</div>
<div class="section" id="directory-structure">
<h3>Directory structure<a class="headerlink" href="#directory-structure" title="Permalink to this headline">¶</a></h3>
<p>The release directory structure for synthesis is shown below:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>&lt;NVDLA_RELEASE&gt;
   |--- syn
   |--- scripts
   |       |--- syn_launch.sh
   |       |--- default_config.sh
   |       |--- dc_run.tcl
   |       |--- dc_interactive.tcl
   |       `--- dc_app_vars.tcl
   |--- templates
   |       |--- config.sh
   |       `--- cg_latency_lut.tcl
   `--- cons
          |--- NV_NVDLA_partition_a.sdc
          |--- NV_NVDLA_partition_c.sdc
          |--- NV_NVDLA_partition_m.sdc
          |--- NV_NVDLA_partition_o.sdc
          `--- NV_NVDLA_partition_p.sdc
</pre></div>
</div>
<p><code class="docutils literal notranslate"><span class="pre">NV_NVDLA_partition_*</span></code> are synthesis <strong>“TOP_NAMES”</strong> - The designs will be compiled at this
hierarchy, and netlists will be generated for these designs. These are independent
sub-designs for synthesis, which are instantiated in a top-level wrapper.</p>
</div>
<div class="section" id="requirements">
<h3>Requirements<a class="headerlink" href="#requirements" title="Permalink to this headline">¶</a></h3>
<p>You will need a *NIX machine able to run Design Compiler.
The scripts have been tested with Design Compiler version 2016.12 and newer.
Memory and CPU requirements vary.</p>
</div>
<div class="section" id="synthesis-configuration">
<h3>Synthesis Configuration<a class="headerlink" href="#synthesis-configuration" title="Permalink to this headline">¶</a></h3>
<p>To be able to run synthesis, you will need a config file - You can use
the “&lt;NVDLA_ROOT&gt;/syn/dc/templates/config.sh” file  as reference. This file is in “bash” syntax.</p>
<p>There are many required and optional variables. Table below lists the supported
variables, meanings and defaults.</p>
<div class="line-block">
<div class="line"><br /></div>
<div class="line"><br /></div>
</div>
<table class="colwidths-given docutils align-default" id="id14">
<caption><span class="caption-number">Table 39 </span><span class="caption-text">Design Related Options</span><a class="headerlink" href="#id14" title="Permalink to this table">¶</a></caption>
<colgroup>
<col style="width: 25%" />
<col style="width: 75%" />
</colgroup>
<thead>
<tr class="row-odd"><th class="head"><p>Variable</p></th>
<th class="head"><p>Comments</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p><code class="docutils literal notranslate"><span class="pre">NVDLA_ROOT</span></code></p></td>
<td><p>Location on disk for the NVDLA source “hw” directory.</p></td>
</tr>
<tr class="row-odd"><td><p><code class="docutils literal notranslate"><span class="pre">TOP_NAMES</span></code></p></td>
<td><p>Space separated list of TOP_NAMES to synthesize. You may choose to synthesize all or a subset of TOP_NAMES.
Defaults to
“NV_NVDLA_partition_a NV_NVDLA_partition_c NV_NVDLA_partition_o NV_NVDLA_partition_m NV_NVDLA_partition_p”</p></td>
</tr>
<tr class="row-even"><td><p><code class="docutils literal notranslate"><span class="pre">RTL_SEARCH_PATH</span></code></p></td>
<td><p>Space separated list of search paths (directories) for locating all the pieces of RTL.
Defaults to an empty string.
Please do not include paths to non synthesizable (behavioral) RAM models, like the ones in <code class="docutils literal notranslate"><span class="pre">${NVDLA_ROOT}/vmod/rams/model</span></code></p></td>
</tr>
<tr class="row-odd"><td><p><code class="docutils literal notranslate"><span class="pre">RTL_INCLUDE_SEARCH_PATH</span></code></p></td>
<td><p>Space separated list of search paths (directories) for locating all the supplementary Verilog include files.
Defaults to an empty string.</p></td>
</tr>
<tr class="row-even"><td><p><code class="docutils literal notranslate"><span class="pre">EXTRA_RTL</span></code></p></td>
<td><p>List of files to read in, apart from the modules that can be found in the search paths.
Defaults to an empty string.</p></td>
</tr>
<tr class="row-odd"><td><p><code class="docutils literal notranslate"><span class="pre">RTL_EXTENSIONS</span></code></p></td>
<td><p>List of extensions for the source RTL files.
Defaults to “.v .sv .gv”</p></td>
</tr>
<tr class="row-even"><td><p><code class="docutils literal notranslate"><span class="pre">RTL_INCLUDE_EXTENSIONS</span></code></p></td>
<td><p>List of extensions for supplementary Verilog include files. Defaults to “.vh .svh”</p></td>
</tr>
<tr class="row-odd"><td><p><code class="docutils literal notranslate"><span class="pre">DEF</span></code></p></td>
<td><p>Path to directory containing floorplans in the “DEF” format. Files should be named by the TOP_NAMES, with the extension “.def”
This variable defaults to a directory called  “def” in the current directory</p>
<p>We do not provide templates, because it depends on the process node, and the memory compiler being used.</p>
</td>
</tr>
<tr class="row-even"><td><p><code class="docutils literal notranslate"><span class="pre">CONS</span></code></p></td>
<td><p>Path to directory containing constraints in the “SDC” format.
Files should be named by the TOP_NAMES, with the extension “.sdc”
This directory may also contain “&lt;TOP_NAME&gt;.tcl” to specify any non-SDC constraints to guide synthesis.
All of these constraints are sourced before compiling the design.
This variable defaults to a directory called “cons” in the current directory.</p>
<p>We provide template SDCs for all logical partitions in the <cite>${NVDLA_ROOT}/syn/cons</cite> directory including
clock constraints etc. You may provide your own constraints, based on the process node you are targeting.</p>
</td>
</tr>
</tbody>
</table>
<div class="line-block">
<div class="line"><br /></div>
<div class="line"><br /></div>
<div class="line"><br /></div>
</div>
<table class="colwidths-given docutils align-default" id="id15">
<caption><span class="caption-number">Table 40 </span><span class="caption-text">Tool Related Options</span><a class="headerlink" href="#id15" title="Permalink to this table">¶</a></caption>
<colgroup>
<col style="width: 25%" />
<col style="width: 75%" />
</colgroup>
<thead>
<tr class="row-odd"><th class="head"><p>Variable</p></th>
<th class="head"><p>Comments</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p><code class="docutils literal notranslate"><span class="pre">DC_PATH</span></code></p></td>
<td><p>Location of the Design Compiler installation.
Defaults to an empty string</p></td>
</tr>
</tbody>
</table>
<div class="line-block">
<div class="line"><br /></div>
<div class="line"><br /></div>
<div class="line"><br /></div>
</div>
<table class="colwidths-given docutils align-default" id="id16">
<caption><span class="caption-number">Table 41 </span><span class="caption-text">Library Related Options</span><a class="headerlink" href="#id16" title="Permalink to this table">¶</a></caption>
<colgroup>
<col style="width: 25%" />
<col style="width: 75%" />
</colgroup>
<thead>
<tr class="row-odd"><th class="head"><p>Variable</p></th>
<th class="head"><p>Comments</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p><code class="docutils literal notranslate"><span class="pre">TARGET_LIB</span></code></p></td>
<td><p>Path to a single standard cell library that will be used to map the design to (the “target” library).
Defaults to an empty string.</p></td>
</tr>
<tr class="row-odd"><td><p><code class="docutils literal notranslate"><span class="pre">LINK_LIB</span></code></p></td>
<td><p>Path to all the libraries that are required to link the design.
This should include the target library as well.
Include any RAM compiler timing libraries here.
Defaults to an empty string.</p></td>
</tr>
<tr class="row-even"><td><p><code class="docutils literal notranslate"><span class="pre">TF_FILE</span></code></p></td>
<td><p>Path to the “Milkyway Technology File” that is used to create the Milkyway models for the physical library.
Please check with your standard cell library vendor for the right file to use.
Defaults to an empty string.
Required for DC-Topographical</p></td>
</tr>
<tr class="row-odd"><td><p><code class="docutils literal notranslate"><span class="pre">TLUPLUS_FILE</span></code></p></td>
<td><p>Path to the “TLUPlus” files that will be used for RC extraction
Please check with your standard cell library vendor for the right file to use.
Defaults to an empty string.
Required for DC-Topographical</p></td>
</tr>
<tr class="row-even"><td><p><code class="docutils literal notranslate"><span class="pre">TLUPLUS_MAPPING_FILE</span></code></p></td>
<td><p>Path to the “Tech2ITF” mapping file, that maps layer names from between the Milkyway Tech file and the interconnect technology format file.
Please check with your standard cell library vendor for the right file to use.
Defaults to an empty string.
Required for DC-Topographical</p></td>
</tr>
<tr class="row-odd"><td><p><code class="docutils literal notranslate"><span class="pre">MIN_ROUTING_LAYER</span></code></p></td>
<td><p>Bottom routing layer for signal nets.
Please check with place-and-route methodology for the right value.
Defaults to an empty string.
Required for DC-Topographical</p></td>
</tr>
<tr class="row-even"><td><p><code class="docutils literal notranslate"><span class="pre">MAX_ROUTING_LAYER</span></code></p></td>
<td><p>Top routing layer for signal nets.
Please check with place-and-route methodology for the right value.
Defaults to an empty string.
Required for DC-Topographical</p></td>
</tr>
<tr class="row-odd"><td><p><code class="docutils literal notranslate"><span class="pre">HORIZONTAL_LAYERS</span></code></p></td>
<td><p>Space separated list of layers with preferred horizontal routing.
Defaults to an empty string.</p></td>
</tr>
<tr class="row-even"><td><p><code class="docutils literal notranslate"><span class="pre">VERTICAL_LAYERS</span></code></p></td>
<td><p>Space separated list of layers with preferred vertical routing.
Defaults to an empty string.</p></td>
</tr>
<tr class="row-odd"><td><p><code class="docutils literal notranslate"><span class="pre">DONT_USE_LIST</span></code></p></td>
<td><p>Space separated list of regular expressions for cells that you do not wish to map your design to.
A “dont_use” will be applied on these cells in Design Compiler.
Defaults to an empty string.</p></td>
</tr>
<tr class="row-even"><td><p><code class="docutils literal notranslate"><span class="pre">WIRELOAD_MODEL_FILE</span></code></p></td>
<td><p>A file containing a “wireload model” - a lookup table for resistance and capacitance calculation based on fanout.
Refer to the lcug16_Defining_Wire_Load_Groups.htm on the Synopsys Solvnet site
for more information regarding wire load modeling.
Not required if your standard cell library contains the wireload models built in.
Not required for DC-Topographical.
Defaults to an empty string.</p></td>
</tr>
<tr class="row-odd"><td><p><code class="docutils literal notranslate"><span class="pre">WIRELOAD_MODEL_NAME</span></code></p></td>
<td><p>Name of the wireload model lookup table (if you have multiple tables)
Not required for DC-Topographical.
Defaults to an empty string.</p></td>
</tr>
</tbody>
</table>
<div class="line-block">
<div class="line"><br /></div>
<div class="line"><br /></div>
<div class="line"><br /></div>
</div>
<div class="admonition warning">
<p class="admonition-title">Warning</p>
<p>We do not supply timing models or synthesizable RTL for the RAMs in the design.
These need to be provided by the user for the process node/ memory compiler being used.</p>
<p>Please DO NOT include <code class="docutils literal notranslate"><span class="pre">${NVDLA_ROOT}/vmod/rams/model</span></code> in the RTL_SEARCH_PATH - They are simulation models, not synthesizable.</p>
</div>
<table class="colwidths-given docutils align-default" id="id17">
<caption><span class="caption-number">Table 42 </span><span class="caption-text">Miscellaneous Options</span><a class="headerlink" href="#id17" title="Permalink to this table">¶</a></caption>
<colgroup>
<col style="width: 25%" />
<col style="width: 75%" />
</colgroup>
<thead>
<tr class="row-odd"><th class="head"><p>Variable</p></th>
<th class="head"><p>Comments</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p><code class="docutils literal notranslate"><span class="pre">TIGHTEN_CGE</span></code></p></td>
<td><p>Boolean, “1” to enable over constraining the CG-Enable paths. See section 5.5.2 below
Default is set to “0”</p></td>
</tr>
<tr class="row-odd"><td><p><code class="docutils literal notranslate"><span class="pre">CGLUT_FILE</span></code></p></td>
<td><p>File containing the fanout-based CG over constraint lookup table to pessimize the CG enable paths. See section 5.5.2 below.
Please see “${NVDLA_ROOT}/syn/templates/cg_latency_lut.tcl” for an example.
Defaults to an empty string.</p></td>
</tr>
<tr class="row-even"><td><p><code class="docutils literal notranslate"><span class="pre">DC_NUM_CORES</span></code></p></td>
<td><p>The number of CPU cores available for Design Compiler.
Defaults to ‘1’
Note: Single CPU core synthesis may see a long overall runtime.</p></td>
</tr>
<tr class="row-odd"><td><p><code class="docutils literal notranslate"><span class="pre">AREA_RECOVERY</span></code></p></td>
<td><p>Boolean, “1” to Run quick area optimization by undoing some optimizations on paths with positive slack.
Defaults to “1”.</p></td>
</tr>
<tr class="row-even"><td><p><code class="docutils literal notranslate"><span class="pre">INCREMENTAL_RECOMPILE_COUNT</span></code></p></td>
<td><p>Number of rounds of incremental compiles  to run in Design Compiler.
Defaults to “1” - This amounts to 2 rounds of compile, one for mapping - the “main” compile
and one for incremental optimization - the “incremental” compile.</p></td>
</tr>
<tr class="row-odd"><td><p><code class="docutils literal notranslate"><span class="pre">COMMAND_PREFIX</span></code></p></td>
<td><p>String.
Defaults to an empty string.
This will be pre-fixed to the dc_shell command .
Use this to manage job submission  on LSF farm or grid, as appropriate.
Use literal strings “&lt;MODULE&gt;” and “&lt;LOG&gt;” to substitute module name and log directory for each TOP_NAMES.
In the absence of a command prefix, the synthesis  jobs for each TOP_NAMES will run serially.
If you do provide a command prefix, make sure that it is non-blocking, so that all synthesis jobs
can be parallelized. Otherwise, the jobs are run serially.
Example:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">export</span> <span class="n">COMMAND_PREFIX</span><span class="o">=</span><span class="s2">&quot;bsub -q some_queue -o &lt;LOG&gt;/&lt;MODULE&gt;.lsf.log&quot;</span>
</pre></div>
</div>
</td>
</tr>
</tbody>
</table>
</div>
<div class="section" id="synthesis-constraints">
<h3>Synthesis constraints<a class="headerlink" href="#synthesis-constraints" title="Permalink to this headline">¶</a></h3>
<div class="section" id="clock-constraints">
<h4>Clock Constraints<a class="headerlink" href="#clock-constraints" title="Permalink to this headline">¶</a></h4>
<p>The clock constraints are provided through an SDC file.
You will find reference constraints in “${NVDLA_ROOT}/syn/cons/NV_NVDLA_partition*.sdc”.
These contain clock targets for the 16nm process. You will need to scale the clock
constraints to the target process/synthesis corner as appropriate.
The SDC files also contain some timing exceptions (false paths) as well.
Please populate the SDC files for all TOP_NAMES in a single directory, and set the CONS variable
in the configuration file described in the previous section.</p>
<p>You can also add additional non-SDC constraints, like, for example, specific clock gating styles, etc. in &lt;CONS&gt;/NV_NVDLA_partition*.tcl</p>
</div>
<div class="section" id="clock-gate-enable-path-over-constraining">
<h4>Clock Gate Enable Path Over constraining<a class="headerlink" href="#clock-gate-enable-path-over-constraining" title="Permalink to this headline">¶</a></h4>
<p>The flow allows for over constraining the CG enable paths to pessimize synthesis to take into account post-CTS latencies.
This is achieved through a fanout-based lookup table in TCL syntax. See “${NVDLA_ROOT}/syn/templates/cg_latency_lut.tcl” for an example.
Provide the path to this file as the CGLUT_FILE variable in the configuration file.
To enable the over constraining, please set TIGHTEN_CGE variable to 1 in the configuration file.</p>
</div>
<div class="section" id="physical-constraints">
<h4>Physical Constraints<a class="headerlink" href="#physical-constraints" title="Permalink to this headline">¶</a></h4>
<p>If you are running physical synthesis, you can provide floorplans in DEF syntax for
RAM/IO placement as input, depending on your physical implementation.
Populate the DEF files for all TOP_NAMES in a single directory, and provide the path
to the directory as the DEF variable.</p>
<p>You can also provide constraints in TCL syntax, through “&lt;CONS&gt;/NV_NVDLA_partition*.tcl” files.</p>
</div>
</div>
<div class="section" id="running-synthesis">
<h3>Running synthesis<a class="headerlink" href="#running-synthesis" title="Permalink to this headline">¶</a></h3>
<p>You can run synthesis using the “${NVDLA_ROOT}/syn/dc/scripts/syn_launch.sh” bash script.
The supported arguments to the scripts are in table below.</p>
<div class="line-block">
<div class="line"><br /></div>
</div>
<table class="colwidths-given docutils align-default" id="id18">
<caption><span class="caption-number">Table 43 </span><span class="caption-text">Miscellaneous Options</span><a class="headerlink" href="#id18" title="Permalink to this table">¶</a></caption>
<colgroup>
<col style="width: 25%" />
<col style="width: 75%" />
</colgroup>
<thead>
<tr class="row-odd"><th class="head"><p>Argument</p></th>
<th class="head"><p>Explanation</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p><code class="docutils literal notranslate"><span class="pre">-config</span></code></p></td>
<td><p>Path to the synthesis configuration file (see section 5.4)
If not provided, the flow will look for a file called “config.sh” in the current directory.</p></td>
</tr>
<tr class="row-odd"><td><p><code class="docutils literal notranslate"><span class="pre">-mode</span></code></p></td>
<td><p>Specifies which tool to use for synthesis. Use one of the following:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>“wlm” =&gt; Use Design Compiler (non-topographical) for wireload model based synthesis (non-physical)
“dct” =&gt; Use DC-Topographical
“dcg” =&gt; Use DC-Graphical along with “-spg” in the compile command.
“de”  =&gt; Use DC Explorer for synthesis.
</pre></div>
</div>
</td>
</tr>
<tr class="row-even"><td><p><code class="docutils literal notranslate"><span class="pre">-build</span></code></p></td>
<td><p>Sandbox of synthesis. Optional.
Defaults to “<code class="docutils literal notranslate"><span class="pre">nvdla_syn_&lt;timestamp&gt;</span></code>”</p></td>
</tr>
<tr class="row-odd"><td><p><code class="docutils literal notranslate"><span class="pre">-modules</span></code></p></td>
<td><p>Space separated list of modules to run synthesis on / restore database for.
If not specified, the TOP_NAMES must be populated in the configuration file.</p></td>
</tr>
<tr class="row-even"><td><p><code class="docutils literal notranslate"><span class="pre">-restore</span></code></p></td>
<td><p>Path to design database (in DDC format) to restore.</p></td>
</tr>
</tbody>
</table>
<div class="line-block">
<div class="line"><br /></div>
</div>
<div class="section" id="running-non-physical-synthesis-wireload-models">
<h4>Running Non-physical synthesis (Wireload Models)<a class="headerlink" href="#running-non-physical-synthesis-wireload-models" title="Permalink to this headline">¶</a></h4>
<p>You can run:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>${NVDLA_ROOT}/syn/dc/scripts/syn_launch.sh -mode wlm -config /path/to/config.sh
</pre></div>
</div>
<p>You will need to have a wire load model defined in your standard cell library, or in a
separate file (in liberty syntax, as described in the lcug16_Defining_Wire_Load_Groups.htm
on Synopsys solvnet)</p>
<p>In the configuration file the following variables are required to be defined:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">WIRELOAD_MODEL_NAME</span>
<span class="n">TARGET_LIB</span>
<span class="n">LINK_LIB</span>
<span class="n">DC_PATH</span>
</pre></div>
</div>
<p>The following variables are optional:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">WIRELOAD_MODEL_FILE</span>
</pre></div>
</div>
</div>
<div class="section" id="running-physical-synthesis">
<h4>Running physical synthesis<a class="headerlink" href="#running-physical-synthesis" title="Permalink to this headline">¶</a></h4>
<p>You can run one of the following, To pick DC-Topographical/DC-Graphical/DC Explorer:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>${NVDLA_ROOT}/syn/dc/scripts/syn_launch.sh -mode dct -config /path/to/config.sh
${NVDLA_ROOT}/syn/dc/scripts/syn_launch.sh -mode dcg -config /path/to/config.sh
${NVDLA_ROOT}/syn/dc/scripts/syn_launch.sh -mode de -config /path/to/config.sh
</pre></div>
</div>
<p>In the configuration file, the following variables are required to be defined:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">TARGET_LIB</span>
<span class="n">LINK_LIB</span>
<span class="n">MW_LIB</span>
<span class="n">DC_PATH</span>
<span class="n">TF_FILE</span>
<span class="n">TLUPLUS_FILE</span>
<span class="n">TLUPLUS_MAPPING_FILE</span>
<span class="n">MIN_ROUTING_LAYER</span>
<span class="n">MAX_ROUTING_LAYER</span>
</pre></div>
</div>
<p>Additionally, you may require the following variables depending on how your physical library views were built:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">HORIZONTAL_LAYERS</span>
<span class="n">VERTICAL_LAYERS</span>
</pre></div>
</div>
</div>
<div class="section" id="restoring-a-design-database">
<h4>Restoring a design database<a class="headerlink" href="#restoring-a-design-database" title="Permalink to this headline">¶</a></h4>
<p>You can run one of the following, To restore a design database from a previous synthesis run with the reference methodology:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>${NVDLA_ROOT}/syn/dc/scripts/syn_launch.sh -mode &lt;mode_used_for_synthesis&gt; -config /path/to/config.sh -build &lt;build_tag_used_for_synthesis&gt; -restore /path/to/build/db/&lt;module&gt;.ddc -modules &lt;module&gt;
</pre></div>
</div>
</div>
</div>
<div class="section" id="synthesis-outputs">
<h3>Synthesis outputs<a class="headerlink" href="#synthesis-outputs" title="Permalink to this headline">¶</a></h3>
<p>In the synthesis sandbox, the following outputs are generated:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>&lt;BUILD&gt;
   |--- fv
   |     `--- NV_NVDLA_parition*
   |              `--- NV_NVDLA_parition*.svf
   |--- net
   |     |--- NV_NVDLA_partition*.gv (Mapped Netlist)
   |     |--- NV_NVDLA_partition*.full.def (complete output DEF)
   |     `--- NV_NVDLA_partition*.sdc (Output SDC)
   |--- db
   |     `--- NV_NVDLA_partition*.ddc (Synthesis design Database)
   |           (There are also a few intermediate design databases here)
   `--- report
           |--- NV_NVDLA_partition*.check_design
           |--- NV_NVDLA_partition*.check_timing
           `--- NV_NVDLA_partition*.final.report
                      (Detailed timing/QoR information)
                      (There are also reports generated at intermediate stages)
</pre></div>
</div>
</div>
</div>
<div class="section" id="testbench-traces">
<span id="testbench"></span><h2>Testbench &amp; Traces<a class="headerlink" href="#testbench-traces" title="Permalink to this headline">¶</a></h2>
<p>This section describes the trace-player testbench and traces supplied with the release.  The
testbench is intended to be used
to validate basic RTL functionality, and to provide a reference for RTL integration efforts.
The tests themselves are inteded to work either in the included testbench or within an SoC
simulation.  When used within an SoC simulation, it is expected that the SoC’s processor will
playing back the trace and responding to NVDLA interrupts.  The trace format is documented below.</p>
<div class="section" id="tests">
<h3>Tests<a class="headerlink" href="#tests" title="Permalink to this headline">¶</a></h3>
<p>The NVDLA repository contains seven basic sanity tests, and two layer tests.  Additional tests will be added periodically.</p>
</div>
<div class="section" id="basic-sanity-tests">
<h3>Basic sanity tests<a class="headerlink" href="#basic-sanity-tests" title="Permalink to this headline">¶</a></h3>
<ul class="simple">
<li><p>sanity0 - basic register write and compare read-back value</p></li>
<li><p>sanity1 - memory copy test using bdma (dbb to dbb), test ends using register polling</p></li>
<li><p>sanity2 - sanity1 waiting on interrupts instead of register polling</p></li>
<li><p>sanity3 - convolution test, test ends using register polling and compares output mem region to determine passing</p></li>
<li><p>sanity3_cvsram - convolution test, uses cvsram path instead of dbb, test ends using register polling and compares output mem region to determine passing</p></li>
</ul>
</div>
<div class="section" id="short-single-function-tests-using-dbb">
<h3>Short single function tests using dbb<a class="headerlink" href="#short-single-function-tests-using-dbb" title="Permalink to this headline">¶</a></h3>
<ul class="simple">
<li><p>conv_8x8_fc_int16</p></li>
<li><p>pdp_max_pooling_int16</p></li>
<li><p>sdp_relu_int16</p></li>
</ul>
</div>
<div class="section" id="long-layer-tests">
<h3>Long layer tests<a class="headerlink" href="#long-layer-tests" title="Permalink to this headline">¶</a></h3>
<ul class="simple">
<li><p>googlenet_conv2_3x3_int16 - uses cvsram, 30 min runtime</p></li>
<li><p>cc_alexnet_conv5_relu5_int16_dtest_cvsram - uses cvsram, 156 min runtime</p></li>
</ul>
<p>The long layer tests are not in the regress target. Run using</p>
<ul class="simple">
<li><p>make run TESTDIR=../traces/traceplayer/googlenet_conv2_3x3_int16</p></li>
<li><p>make run TESTDIR=../traces/traceplayer/cc_alexnet_conv5_relu5_int16_dtest_cvsram</p></li>
</ul>
</div>
<div class="section" id="test-format">
<span id="id6"></span><h3>Test Format<a class="headerlink" href="#test-format" title="Permalink to this headline">¶</a></h3>
<p>Tests will be in trace form and will support seven commands:  cpu read/write, memory read/write,
memory load/dump, and interrupt wait.</p>
<p>Tests read in input.txn in what we call “trace” format which is a file containing a list of
register and memory accesses that will be used by the test before finishing the simulation. The script in synth_tb/sim_scripts/inp_txn_to_hexdump.pl reads input.txn and outputs input.txn.raw containing encodings for the csb master sequencer to read and execute from.</p>
<div class="section" id="hardware-config-read-write-commands">
<h4>Hardware Config Read/Write Commands<a class="headerlink" href="#hardware-config-read-write-commands" title="Permalink to this headline">¶</a></h4>
<p>The main test trace performs register reads/writes to the NVDLA IP.  These commands
will cause reads and write commands to the CSB programming bus.</p>
<p>Reg read and write Commands are listed in the following table.</p>
<table class="colwidths-given docutils align-default">
<colgroup>
<col style="width: 40%" />
<col style="width: 60%" />
</colgroup>
<thead>
<tr class="row-odd"><th class="head"><p>Command</p></th>
<th class="head"><p>Description</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p>write_reg &lt;misc:16&gt;&lt;addr:16&gt; &lt;data:32&gt;</p></td>
<td><p>Execute a 32b data write to a 16b addr.</p>
<p>addr is calculated from
(documented register address - NVDLA_GLB.S_NVDLA_HW_VERSION_0.offset) &gt;&gt; 2.
Left shift by 2 because hardware expects the word address.</p>
<p>Bit 1 of misc (bit 17 of 32b field) means CSB master will wait for wr_complete or error
before sending next read or write.
Bit 0 of misc (bit 16 of 32b field) is 1 for writes and 0 for reads.</p>
<p>inp_txn_to_hexdump.pl will correct the rd/wr bit based on read_reg/write_reg cmd.
Examples:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">write_reg</span> <span class="mh">0x00030200</span> <span class="mh">0x1234c0de</span> <span class="o">//</span><span class="n">Wait</span> <span class="k">for</span> <span class="n">wr_complete</span> <span class="ow">or</span> <span class="n">error</span>
<span class="n">write_reg</span> <span class="mh">0x00010200</span> <span class="mh">0x1234da7a</span> <span class="o">//</span><span class="n">Don</span><span class="s1">&#39;t wait for wr_complete or error</span>
</pre></div>
</div>
</td>
</tr>
<tr class="row-odd"><td><p>read_reg &lt;misc:16&gt;&lt;addr:16&gt; &lt;bitmask:32&gt; &lt;expectedData:32&gt;</p></td>
<td><p>Execute a polling read to 16b addr and poll until (returnData &amp; bitmask) == expectedData.
Number of polls will be equal to  +read_reg_poll_retries (default 50).
Examples:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">read_reg</span>  <span class="mh">0x00000200</span> <span class="mh">0xffffffff</span> <span class="mh">0x1234da7a</span> <span class="o">//</span><span class="mh">0x0020</span> <span class="n">read</span> <span class="n">back</span> <span class="n">should</span> <span class="n">be</span> <span class="mh">0x1234da7a</span>
</pre></div>
</div>
</td>
</tr>
</tbody>
</table>
</div>
<div class="section" id="memory-read-write-commands">
<h4>Memory Read/Write Commands<a class="headerlink" href="#memory-read-write-commands" title="Permalink to this headline">¶</a></h4>
<p>To accelerate simulation these trace commands perform reads/writes directly to the memory model.</p>
<p>Memory read and write Commands are listed in the following table.</p>
<table class="colwidths-given docutils align-default">
<colgroup>
<col style="width: 40%" />
<col style="width: 60%" />
</colgroup>
<thead>
<tr class="row-odd"><th class="head"><p>Command</p></th>
<th class="head"><p>Description</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p>write_mem &lt;addr:64&gt; &lt;bytemask:16&gt; &lt;wdata:128&gt;</p></td>
<td><p>Execute a 128b data write with corresponding 16 byte mask to 64b addr.</p></td>
</tr>
<tr class="row-odd"><td><p>read_mem &lt;addr:64&gt; &lt;bitmask:128&gt; &lt;expectedData:128&gt;</p></td>
<td><p>Execute a polling read to 64b addr and poll until 128b expectedData is met.
Number of polls will be equal to  +read_mem_poll_retries (default 50).
Example:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">read_mem</span> <span class="mh">0x41000000</span> <span class="mh">0xffffffffffffffffffffffffffffffffffffffffffffffff</span>
                    <span class="mh">0x00000000000000000000000000080000</span>
</pre></div>
</div>
</td>
</tr>
</tbody>
</table>
</div>
<div class="section" id="memory-load-dump-command">
<h4>Memory Load/Dump Command<a class="headerlink" href="#memory-load-dump-command" title="Permalink to this headline">¶</a></h4>
<p>To further accelerate simulation, the trace supports loading and dumping of memory directly to/from a file.</p>
<table class="colwidths-given docutils align-default">
<colgroup>
<col style="width: 40%" />
<col style="width: 60%" />
</colgroup>
<thead>
<tr class="row-odd"><th class="head"><p>Command</p></th>
<th class="head"><p>Description</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p>load_mem &lt;addr:64&gt; &lt;num_bytes:32&gt; &lt;string&gt;</p></td>
<td><p>Use Verilog $readmemh() to load memory with 32b num_bytes at 64b addr from file, “string”.</p></td>
</tr>
<tr class="row-odd"><td><p>dump_mem &lt;addr:64&gt; &lt;num_bytes:32&gt; &lt;string&gt;</p></td>
<td><p>Use Verilog $writememh() to dump 32b num_bytes at 64b addr of memory to file, “string”.</p></td>
</tr>
</tbody>
</table>
</div>
<div class="section" id="interrupt-wait-command">
<h4>Interrupt Wait Command<a class="headerlink" href="#interrupt-wait-command" title="Permalink to this headline">¶</a></h4>
<p>This command allows for trace replay to pause while NVDLA completes a task.  An interrupt from NVDLA
will resume trace execution.</p>
<table class="colwidths-given docutils align-default">
<colgroup>
<col style="width: 40%" />
<col style="width: 60%" />
</colgroup>
<thead>
<tr class="row-odd"><th class="head"><p>Command</p></th>
<th class="head"><p>Description</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p>wait &lt;level/edge&gt; &lt;irq#&gt;</p></td>
<td><p>Block the current trace until either an interrupt level or edge is detected:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">wait</span> <span class="n">high</span> <span class="n">dla_intr</span>     <span class="o">//</span> <span class="n">Wait</span> <span class="k">for</span> <span class="n">high</span> <span class="n">level</span> <span class="n">on</span> <span class="n">dla_intr</span>
<span class="n">wait</span> <span class="n">low</span> <span class="n">dla_intr</span>      <span class="o">//</span> <span class="n">Wait</span> <span class="k">for</span> <span class="n">low</span> <span class="n">level</span> <span class="n">on</span> <span class="n">dla_intr</span>
<span class="n">wait</span> <span class="n">posedge</span> <span class="n">dla_intr</span>  <span class="o">//</span> <span class="n">Wait</span> <span class="k">for</span> <span class="n">posedge</span> <span class="n">on</span> <span class="n">dla_intr</span>
<span class="n">wait</span> <span class="n">negedge</span> <span class="n">dla_intr</span>  <span class="o">//</span> <span class="n">Wait</span> <span class="k">for</span> <span class="n">negedge</span> <span class="n">on</span> <span class="n">dla_intr</span>
</pre></div>
</div>
</td>
</tr>
</tbody>
</table>
</div>
</div>
<div class="section" id="reference-simulation-testbench">
<span id="simulation-testbench"></span><h3>Reference Simulation Testbench<a class="headerlink" href="#reference-simulation-testbench" title="Permalink to this headline">¶</a></h3>
<div class="section" id="csb-master-trace-player">
<h4>CSB Master Trace Player<a class="headerlink" href="#csb-master-trace-player" title="Permalink to this headline">¶</a></h4>
<p>The trace player is an master agent that reads a test vector file, typically input.txn, in the format as described in the Tests section.  It parses and supports seven operations:  polling read and write to/from NVDLA; polling read and write directly to/from memory;   file load and dump directly to/from memory; and wait for interrupt.
The memory write, load, and dump commands occur in zero simulation time.  The polling memory read function retries after 100 clocks up to 100 times, by default.  The read_mem retry and delay counts are configurable with the +read_mem_poll_retries and +read_mem_poll_interval_clocks plusargs, respectively.  The polling reg read functions retries after 100 clocks upto 100 times, by default.  The read_reg retry and delay counts are configurable with the +read_reg_poll_retries and +read_reg_poll_interval_clocks plusargs, respectively.  The reg write functions blocks until the write transaction is accepted by the NVDLA.   The wait blocks until the interrupt event occurs.</p>
</div>
<div class="section" id="dbbif-slave-agent">
<h4>DBBIF Slave Agent<a class="headerlink" href="#dbbif-slave-agent" title="Permalink to this headline">¶</a></h4>
<p>The DBBIF slave agent captures DBBIF memory transactions and issues reads and writes to memory.  The NVDLA and environment supports one slave agent per memory region, 16B/clk.</p>
</div>
<div class="section" id="cvsram-slave-agent">
<h4>CVSRAM Slave Agent<a class="headerlink" href="#cvsram-slave-agent" title="Permalink to this headline">¶</a></h4>
<p>The CVSRAM slave agent captures CVSRAM memory transactions and issues reads and writes to a section of memory logically separate from DBB.  The NVDLA and environment supports one slave agent per memory region, 16B/clk.</p>
</div>
<div class="section" id="memory-stub">
<h4>Memory Stub<a class="headerlink" href="#memory-stub" title="Permalink to this headline">¶</a></h4>
<p>The memory stub is a large, linear addressable Verilog memory array.  It’s accessed by the NVDLA via the
DBBIF slave agent.  It can also be triggered by the CSB Master agent to load or store contents to/from
memory via files to reduce overall run time.
The memory stub file access is trigged by load/dump_mem calls within the trace.</p>
</div>
<div class="section" id="running-a-test-using-make">
<h4>Running a Test (using make)<a class="headerlink" href="#running-a-test-using-make" title="Permalink to this headline">¶</a></h4>
<p>The user should “cd” into the ‘export_top/verif/sim’ directory to execute the Makefile
targets described in the sections below.
Note that the Makefile can run multiple tests in parallel by supplying the batch
launch command in the export_top/verif/sim/Makefile ‘LSF_COMMAND’ variable.  E.g, if the user
launches jobs to LSF with ‘bsub –q &lt;LSF queue name&gt;’, the user can set the LSF_COMMAND
variable to this string in the Makefile:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>LSF_COMMAND := bsub –q &lt;LSF queue name&gt;
</pre></div>
</div>
<p>Now when the user runs a multi-test regression, the tests will run in parallel via LSF.</p>
<p>The make targets are described below.</p>
<ul>
<li><p>make sanity</p>
<p>This target will build everything that is needed for any simulation.  It is the first thing that should be done. This make target will also run one test.  With this target, the user can determine if there are any compile or runtime issues with the installation and/or environment in a reasonably short period of time.</p>
</li>
<li><p>make all</p>
<p>This target will build everything that is needed for any simulation.  This make target will also run the regression set of tests.  See make regress for more details.</p>
</li>
<li><p>make build</p>
<p>This target will just generate and execute the VCS compile command line.  If test bench code is changed, this target is used to recompile and generated the VCS based simulation executable.</p>
</li>
<li><p>make run</p>
<p>This target will run a test. Default is the same test that was run with the make all target.  Additional arguments for this target are:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">DUMP</span><span class="o">=</span><span class="p">[</span><span class="mi">0</span><span class="o">|</span><span class="mi">1</span><span class="p">]</span>  <span class="p">(</span><span class="n">specifies</span> <span class="k">if</span> <span class="n">waves</span> <span class="n">are</span> <span class="n">to</span> <span class="n">be</span> <span class="n">dumped</span> <span class="ow">or</span> <span class="ow">not</span><span class="o">.</span>  <span class="mi">0</span> <span class="ow">is</span> <span class="n">default</span><span class="p">,</span> <span class="n">which</span>
             <span class="n">indicates</span> <span class="n">that</span> <span class="n">waves</span> <span class="n">will</span> <span class="ow">not</span> <span class="n">be</span> <span class="n">dumped</span> <span class="n">out</span><span class="p">)</span><span class="o">.</span>
<span class="n">TESTDIR</span><span class="o">=&lt;</span><span class="n">testDirectory</span><span class="o">&gt;</span>  <span class="p">(</span><span class="k">pass</span> <span class="n">a</span> <span class="n">different</span> <span class="n">test</span> <span class="n">that</span> <span class="n">the</span> <span class="n">default</span> <span class="n">which</span>
                          <span class="ow">is</span> <span class="o">../</span><span class="n">traces</span><span class="o">/</span><span class="n">traceplayer</span><span class="o">/</span><span class="n">sanity0</span><span class="p">)</span>
</pre></div>
</div>
<dl class="simple">
<dt>Examples command lines::</dt><dd><p>make run DUMP=1 TESTDIR=../traces/traceplayer/sanity0
make run DUMP=0 TESTDIR=../traces/traceplayer/conv_8x8_fc_int16</p>
</dd>
</dl>
<p>All packaged tests will be found in the verif/traces/* directories.  Within each test directory there is
an ‘input.txn’ file which is a list of the input transactions executed against the DUT.
During simulation an overall log file and also a master transaction and slave transaction log will be
generated to help debug or view what is happening during the simulation. These logs will be found after the
simulation in the same directory as the location of the test input file.  The VCS log will be
named &lt;TESTDIR&gt;/test.log.</p>
</li>
<li><p>make regress</p>
<p>This will run the entire regression serially. At the end of the regression a message will be displayed
to user to check the results of the regression by issuing make check_regress.
The make check_regress will display the results of each test run.
Before running a large regression run a mini regression to make sure there are no environment or
build issues.  A mini regression can be kicked off with:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">make</span> <span class="n">regress</span> <span class="n">MINIREGRESS</span><span class="o">=</span><span class="mi">1</span>
</pre></div>
</div>
<p>One can also run regressions in parallel by using the <code class="docutils literal notranslate"><span class="pre">-j&lt;NUM&gt;</span></code> make option.  For example, to run a full
regression where 3 tests are running simultaneously, but only from the functional set of traces use:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">make</span> <span class="o">-</span><span class="n">j3</span> <span class="n">regress</span>
</pre></div>
</div>
</li>
<li><p>make show_plusargs</p>
<p>This target will display test plus args to be used at run time as well as vcs build args to be used at compile time.</p>
</li>
<li><p>make check</p>
<p>This target runs the ‘export_top/verif/sim/checktest[_synthtb].pl’ script that reports status for a specified test.
For a performance test with a local perf_regs file, it will report the performance score of the test.
For tests with backdoor data, it will also compare the final test memory image with the expected
image and report results of the comparison.</p>
</li>
<li><p>make check_regress</p>
<p>This target is similar to make check but operates on the entire regression.</p>
</li>
<li><p>make dve</p>
<p>This target will bring up the synopsys Discovery Visual Environment  (DVE) waveform viewer so that
input and output signals to the NVDLA can be observed.</p>
</li>
<li><p>make dumper</p>
<p>This target will build the necessary targets if you want to generate verdi or siloti waveform formats.
This target can be kicked off in parallel with the make build target.  It is not added to the
make all target, since not all users have the verdi environment.</p>
</li>
<li><p>make verdi</p>
<p>This target will bring up the verdi design browser and waveform viewer, so that the input and output
signals and transactions can be graphically viewed over time.</p>
</li>
<li><p>make siloti</p>
<p>This target will bring up the siloti design browser and waveform viewer , so that the input and
output signals and transactions can be graphically viewed over time.  This dumping format
is smaller/faster and more efficient.</p>
</li>
</ul>
</div>
<div class="section" id="makefile-run-options">
<h4>Makefile Run Options<a class="headerlink" href="#makefile-run-options" title="Permalink to this headline">¶</a></h4>
<p>The user can specify one or more of the following options during the execution of the make targets.</p>
<table class="colwidths-given docutils align-default">
<colgroup>
<col style="width: 31%" />
<col style="width: 23%" />
<col style="width: 46%" />
</colgroup>
<thead>
<tr class="row-odd"><th class="head"><p>Macro Option</p></th>
<th class="head"><p>Default</p></th>
<th class="head"><p>Description</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p>DUMP=[0|1]</p></td>
<td><p>0</p></td>
<td><p>Controls whether or not waveforms are dumped during the simulation.  1=Dump waveforms.
0=no waveforms dumped.</p></td>
</tr>
<tr class="row-odd"><td><p>MINIREGRESS=[0|1]</p></td>
<td><p>0</p></td>
<td><p>Control whether to run a mini sanity regression with make regress:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>1=Run mini-sanity regression.
0=Don’t run mini-sanity regression.
</pre></div>
</div>
</td>
</tr>
<tr class="row-even"><td><p>PLUSARGS=[“listOfUserPlusOptions”]</p></td>
<td><p>“”</p></td>
<td><p>See options described in the runtime configuration options section later in this document.
The user can supply one or more arguments for run time control of the tests.  This option can
be used with the following make targets:  sanity, all, run, and regress.  For example:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>PLUSARGS=”+mem_read_latency=80 +read_reg_poll_retries=10000”
</pre></div>
</div>
</td>
</tr>
<tr class="row-odd"><td><p>REGRESSTYPE=[FUNC|PERF|APP|ALL]</p></td>
<td><p>ALL</p></td>
<td><p>Guides make regress to run FUNCtional, PERFormance, APPlication, or ALL tests.</p></td>
</tr>
<tr class="row-even"><td><p>TESTDIR=[pathToTestDirectory]</p></td>
<td><p>../traces/traceplayer/sanity0</p></td>
<td><p>Specify the test to run.</p></td>
</tr>
</tbody>
</table>
</div>
<div class="section" id="makefile-config">
<h4>Makefile Config<a class="headerlink" href="#makefile-config" title="Permalink to this headline">¶</a></h4>
<p>The Makefile uses the following major variables to for tool setup.  They should set appropriately based on the environment.</p>
<table class="colwidths-given docutils align-default">
<colgroup>
<col style="width: 33%" />
<col style="width: 33%" />
<col style="width: 33%" />
</colgroup>
<thead>
<tr class="row-odd"><th class="head"><p>Macro</p></th>
<th class="head"><p>Default</p></th>
<th class="head"><p>Description</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p>VCS_HOME</p></td>
<td><p>/home/tools/vcs/mx-2015.09-SP2-9-T0426</p></td>
<td><p>Path to VCS, including version.</p></td>
</tr>
<tr class="row-odd"><td><p>VCS_CC</p></td>
<td><p>/home/utils/gcc-4.7.2/bin/g++</p></td>
<td><p>C compiler used by VCS.</p></td>
</tr>
<tr class="row-even"><td><p>LM_LICENSE_FILE</p></td>
<td><p>/home/tools/admin/license_files</p></td>
<td><p>License file for VCS.</p></td>
</tr>
<tr class="row-odd"><td><p>VERDI_HOME</p></td>
<td><p>/home/tools/debussy/verdi3_2015.09-SP2-11</p></td>
<td><p>Path to verdi waveform viewer.</p></td>
</tr>
<tr class="row-even"><td><p>NOVAS_HOME</p></td>
<td><p>/home/tools/debussy/verdi3_2015.09-SP2-11</p></td>
<td><p>Path to verdi waveform viewer.</p></td>
</tr>
<tr class="row-odd"><td><p>DUMP</p></td>
<td><p>0</p></td>
<td><p>Control whether or not waveforms are dumped during the simulation.  1=Dump waveforms. 0=No waveforms dumped.</p></td>
</tr>
<tr class="row-even"><td><p>DUMPER</p></td>
<td><p>DVE</p></td>
<td><p>Format of the waveform file will by default be in dve format.  To put in Novas’ verdi format use
DUMPER=VERDI . To use Novas essential signal list format use DUMPER=SILOTI</p></td>
</tr>
<tr class="row-odd"><td><p>IMAGEVIEWER</p></td>
<td><p>gimp</p></td>
<td><p>Path to bit map image viewing tool.</p></td>
</tr>
<tr class="row-even"><td><p>VERDI_DUMP_NAME</p></td>
<td><p>debussy</p></td>
<td><p>Name of the verdi dump files</p></td>
</tr>
<tr class="row-odd"><td><p>SILOTI_DUMP_NAME</p></td>
<td><p>siloti</p></td>
<td><p>Name of the siloti (esa enhanced) dump files</p></td>
</tr>
<tr class="row-even"><td><p>VCS_EXECUTABLE</p></td>
<td><p>simv</p></td>
<td><p>Used to specify the name of the generated simulation executable.</p></td>
</tr>
<tr class="row-odd"><td><p>TESTDIR</p></td>
<td><p>../traces/traceplayer/sanity0</p></td>
<td><p>Used to specify the test that user wants to run.</p></td>
</tr>
<tr class="row-even"><td><p>REGRESS_LIST</p></td>
<td><p>see Makefile</p></td>
<td><p>Used to specify the list of tests via directory names that should be run in a regression</p></td>
</tr>
<tr class="row-odd"><td><p>DEFAULT_PLUSARGS</p></td>
<td><p>+continue_on_fail +read_reg_poll_retries=100 +read_reg_poll_interval_clocks=100 +read_reg_timeout_clocks=100000</p></td>
<td><p>Default simulator run time arguments.  See simulator runtime options described later in this document.</p></td>
</tr>
</tbody>
</table>
<p>There are other tools that the Makefile uses and these may need to be adjusted to the customer
Linux environment.  The following table lists these variables.</p>
<table class="colwidths-given docutils align-default">
<colgroup>
<col style="width: 33%" />
<col style="width: 33%" />
<col style="width: 33%" />
</colgroup>
<thead>
<tr class="row-odd"><th class="head"><p>Macro</p></th>
<th class="head"><p>Default</p></th>
<th class="head"><p>Description</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p>AWK</p></td>
<td><p>/usr/bin/awk</p></td>
<td><p>Standard awk. Used as a  pattern scanning and processing language</p></td>
</tr>
<tr class="row-odd"><td><p>CAT</p></td>
<td><p>/bin/cat</p></td>
<td><p>Path to default cat for concatenating files and printing to standard output.</p></td>
</tr>
<tr class="row-even"><td><p>CSH</p></td>
<td><p>/bin/csh</p></td>
<td><p>Path to the environment C shell executable.</p></td>
</tr>
<tr class="row-odd"><td><p>EGREP</p></td>
<td><p>/bin/egrep</p></td>
<td><p>Standard egrep. Used to print lines matching a pattern when passed regexpressions.</p></td>
</tr>
<tr class="row-even"><td><p>GREP</p></td>
<td><p>/bin/grep</p></td>
<td><p>Standard grep. Used to print lines matching a pattern.</p></td>
</tr>
<tr class="row-odd"><td><p>LS</p></td>
<td><p>/bin/ls</p></td>
<td><p>Standard ls for listing what is in a direcotory.</p></td>
</tr>
<tr class="row-even"><td><p>MD5SUM</p></td>
<td><p>/usr/bin/md5sum</p></td>
<td><p>compute and check MD5 message digest</p></td>
</tr>
<tr class="row-odd"><td><p>PERL</p></td>
<td><p>/home/utils/perl-5.14/5.14.1-nothreads-64/bin/perl</p></td>
<td><p>Standard perl installation, for executing perl scripts.</p></td>
</tr>
<tr class="row-even"><td><p>RM</p></td>
<td><p>/bin/rm</p></td>
<td><p>Path to the environment rm executable. Used to remove files and directories.</p></td>
</tr>
<tr class="row-odd"><td><p>TAR</p></td>
<td><p>/bin/tar</p></td>
<td><p>The GNU version of the tar archiving utility</p></td>
</tr>
<tr class="row-even"><td><p>TEE</p></td>
<td><p>/bin/cp</p></td>
<td><p>Standard tee for reading from standard input and writing to standard output and files.</p></td>
</tr>
</tbody>
</table>
</div>
<div class="section" id="test-success">
<h4>Test Success<a class="headerlink" href="#test-success" title="Permalink to this headline">¶</a></h4>
<p>Initial Test success can be seen at the bottom of the standard output after running a test (i.e. after make run)
or by using the make check TESTDIR=&lt;testDirectory&gt;  target.   After a full regression, the user can also use
the make check_regress target to see the results of all tests that have been run.</p>
<p>The following shows an example of the make check output:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">Checking</span> <span class="n">sanity0</span> <span class="n">test</span><span class="o">.</span><span class="n">log</span>
<span class="n">checktest</span> <span class="p">:</span> <span class="n">PASSED</span> <span class="p">:</span> <span class="n">sanity0</span>
</pre></div>
</div>
<p>The following shows an example of the make check_regress output (the user’s specific results may look different depending on which test directories were released in the delivered package):</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">checktest</span> <span class="p">:</span> <span class="n">PASSED</span> <span class="p">:</span> <span class="n">sanity0</span>
<span class="n">checktest</span> <span class="p">:</span> <span class="n">PASSED</span> <span class="p">:</span> <span class="n">sanity1</span>
<span class="n">checktest</span> <span class="p">:</span> <span class="n">PASSED</span> <span class="p">:</span> <span class="n">sanity2</span>
<span class="n">checktest</span> <span class="p">:</span> <span class="n">okPASS</span> <span class="p">:</span> <span class="n">conv_8x8_fc_int16</span><span class="p">:</span> <span class="nb">all</span> <span class="n">transactions</span> <span class="n">completed</span> <span class="p">:</span> <span class="k">with</span> <span class="mi">2</span> <span class="n">non</span> <span class="n">fatal</span> <span class="n">errors</span>
</pre></div>
</div>
<p>The above output would indicate that all tests passed except the conv_8x8_fc_int16 test which had some non-fatal error message that should be looked at.
If the user has done a clean install and not changed any code, the user should expect to see
all regression tests passing.
If the test is a performance test, then make check will also print an additional line
called ‘checkperf’ which will report the performance score of the test, and highlight the delta versus expected.</p>
</div>
<div class="section" id="success-via-looking-at-logfile">
<h4>Success Via Looking At Logfile<a class="headerlink" href="#success-via-looking-at-logfile" title="Permalink to this headline">¶</a></h4>
<p>In addition, the user can go look at the log file.  At the bottom of the test log one would see text that typically follows the following format:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>4020.50ns MSEQ: Backdoor mem_dump of file            0.chiplib_replay.raw2 at address 0x80400000 for length 0x00000020.
$finish called from file &quot;/home/scratch.stephenh_t194/nvdla_git/hw/verif/synth_tb/csb_master_seq.v&quot;, line 271.
$finish at simulation time       4520.90ns
           V C S   S i m u l a t i o n   R e p o r t
Time: 4520900 ps
CPU Time:      4.410 seconds;       Data structure size: 430.9Mb
Mon Sep 25 13:28:44 2017
$finish called.
</pre></div>
</div>
<p>As long as the user sees that there are zero ERRORs and zero FATAL errors, then the test executed successfully. The user should still check the output of checktest_synthtb.pl to verify that mem_dump matches the reference output.</p>
</div>
<div class="section" id="runtime-configuration">
<h4>Runtime Configuration<a class="headerlink" href="#runtime-configuration" title="Permalink to this headline">¶</a></h4>
<ul>
<li><p>CSB Master Trace Player</p>
<p>At runtime, the user can specify various run time control and debug options in the trace player.   By default, no change is required to pass provided tests.</p>
<table class="colwidths-given docutils align-default">
<colgroup>
<col style="width: 50%" />
<col style="width: 50%" />
</colgroup>
<thead>
<tr class="row-odd"><th class="head"><p>Plusarg</p></th>
<th class="head"><p>Description</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p>+ignore_poll</p></td>
<td><p>Don’t retry if poll mismatches.  Just continue running.</p></td>
</tr>
<tr class="row-odd"><td><p>+continue_on_fail</p></td>
<td><p>Retry polls if they mismatch but continue running instead of dying if the limit is hit.</p></td>
</tr>
<tr class="row-even"><td><p>+ignore_badf</p></td>
<td><p>If a register read returns badf, continue instead of polling.  (Used to ignore bad registers in the trace.)</p></td>
</tr>
<tr class="row-odd"><td><p>+read_reg_poll_retries=&lt;cnt&gt;</p></td>
<td><p>Number of retries on reg read.</p></td>
</tr>
<tr class="row-even"><td><p>+read_mem_poll_retries=&lt;cnt&gt;</p></td>
<td><p>Number of retries on mem read.</p></td>
</tr>
<tr class="row-odd"><td><p>+read_reg_poll_interval_clocks=&lt;clks&gt;</p></td>
<td><p>Number of clocks to wait after a bad reg match, before retrying</p></td>
</tr>
<tr class="row-even"><td><p>+read_mem_poll_interval_clocks=&lt;clks&gt;</p></td>
<td><p>Number of clocks to wait after a bad mem match, before retrying</p></td>
</tr>
<tr class="row-odd"><td><p>+intr_timeout_clocks=&lt;clks&gt;</p></td>
<td><p>Number of clocks to wait after a bad interrupt wait, before fatal error.</p></td>
</tr>
</tbody>
</table>
</li>
<li><p>DBBIF Interface To Memory Subsystem</p>
<p>At runtime, the behavior of the DBBIF interface to the memory subsystem can be altered with Verilog plusargs. The user can specify the following.</p>
<table class="colwidths-given docutils align-default">
<colgroup>
<col style="width: 20%" />
<col style="width: 80%" />
</colgroup>
<thead>
<tr class="row-odd"><th class="head"><p>Plusarg</p></th>
<th class="head"><p>Description</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p>+mem_bandwidth_pct=&lt;pct&gt; and +mem_bandwidth_window=&lt;clks&gt;</p></td>
<td><p>Bandwidth: Memory bandwidth can be configured with the plusargs +mem_bandwidth_pct, and +mem_bandwidth_window.  mem_bandwidth_pct (default 50) is a percentage which says how often a data beat can be transferred across the interface.  mem_bandwidth_window is the number of clocks to use as the averaging window for computing the utilization percentage (default 100). This percentage reflects the combined read/write bandwidth of both memory interfaces. As an example, 100% bandwidth utilization would imply that for every clock cycle, write data was being written on both mem0/mem1, and read data was being returned on both mem0/mem1. At 400MHz * 16 bytes * 4 lanes. 100% utilization implies a combined bandwidth of 25.6GB/sec. To limit bandwidth to 12.8GB/sec, a mem_bandwidth_pct of 50 would be used (at most 2 of 4 bidirectional lanes active per clock, on average).</p></td>
</tr>
<tr class="row-odd"><td><p>+mem_read_latency=&lt;clks&gt;</p></td>
<td><p>Read latency:  The read latency of the memory can be configured with the plusarg +mem_read_latency. The value of the parameter determines the number of clock cycles between when the read is accepted and when the read return valid signal is asserted. The default value is 180 (450ns &#64; 400MHz), and the maximum value is 1000.</p></td>
</tr>
<tr class="row-even"><td><p>+mem_write_latency=&lt;clks&gt;</p></td>
<td><p>Write to write ack latency: The write latency of the memory can be configured with the plusarg +mem_write_latency. The value of the parameter determines the number of clock cycles between when the last beat of write data is finished, and when the write response valid signal is asserted. The default value is 30 (75ns &#64; 400MHz), and the maximum value is 1000.</p></td>
</tr>
<tr class="row-odd"><td><p>+max_txn_outstanding_per_channel=&lt;txn&gt;</p></td>
<td><p>Outstanding transaction count:  +max_txn_outstanding_per_channel specifies the total combined read + write transactions that are allowed to be outstanding per channel at any moment of time.  The default value is 128.</p></td>
</tr>
<tr class="row-even"><td><p>+max_rd_outstanding_per_channel=&lt;txn&gt;</p></td>
<td><p>Outstanding read transaction count:
+max_rd_outstanding_per_channel limits the number of read transactions that are allowed to be outstanding per channel at any moment of time.  The default value is 128.</p></td>
</tr>
<tr class="row-odd"><td><p>+max_wr_outstanding_per_channel=&lt;txn&gt;</p></td>
<td><p>Outstanding write transaction count:
+max_wr_outstanding_per_channel limits the number of write transactions that are allowed to be outstanding per channel at any moment of time.  The default value is 128.</p></td>
</tr>
</tbody>
</table>
</li>
</ul>
</div>
</div>
<div class="section" id="verilator-testbench">
<span id="id7"></span><h3>Verilator Testbench<a class="headerlink" href="#verilator-testbench" title="Permalink to this headline">¶</a></h3>
<p>On an experimental basis, the NVDLA release now contains a limited
Verilator-based testbench, enabling the NVDLA RTL to be built and tested
entirely without commercial software.  The Verilator testbench is
expected to work, and is validated against the existing traces, but does not
carry the same level of testing as the SystemVerilog testbench does when
simulated by VCS.</p>
<div class="section" id="setting-up">
<h4>Setting up<a class="headerlink" href="#setting-up" title="Permalink to this headline">¶</a></h4>
<p>The <code class="docutils literal notranslate"><span class="pre">tree.make</span></code> file needs some changes to build with Verilator; in
particular, the <code class="docutils literal notranslate"><span class="pre">VERILATOR</span></code> and <code class="docutils literal notranslate"><span class="pre">CLANG</span></code> environment variables need to be
set.  (The Verilated testbench cannot be built with GCC, because the
generated C++ source is too big.)  Additionally, ensure that your system has
enough memory to build the testbench; depending on your version of
Verilator, you will need a 64-bit system with up to 20GB of RAM (some cases
have been noted in which the requirements are even higher).</p>
<p>Once the <code class="docutils literal notranslate"><span class="pre">tree.make</span></code> file has been updated, you can use <code class="docutils literal notranslate"><span class="pre">tmake</span></code> to build
the simulator:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="o">./</span><span class="n">tools</span><span class="o">/</span><span class="nb">bin</span><span class="o">/</span><span class="n">tmake</span> <span class="o">-</span><span class="n">build</span> <span class="n">verilator</span>
</pre></div>
</div>
<p>The <code class="docutils literal notranslate"><span class="pre">verif/verilator</span></code> directory contains a Makefile that contains
additional options for building the simulator.  For instance, if you need to
dump a <code class="docutils literal notranslate"><span class="pre">.vcd</span></code> waveform from the Verilated simulator, you may wish to
uncomment the line that enables tracing; such traces can be viewed using
<code class="docutils literal notranslate"><span class="pre">gtkwave</span></code> (or with more advanced EDA tools of your choice, including
Verdi).</p>
</div>
<div class="section" id="running-a-test">
<h4>Running a test<a class="headerlink" href="#running-a-test" title="Permalink to this headline">¶</a></h4>
<p>The Verilated simulation can be run by <code class="docutils literal notranslate"><span class="pre">cd</span></code> into <code class="docutils literal notranslate"><span class="pre">verif/verilator</span></code>,
and running a command like:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">make</span> <span class="n">run</span> <span class="n">TEST</span><span class="o">=</span><span class="n">sanity0</span>
</pre></div>
</div>
<p>This will build the simulator (if it has not already been built), compile a
test to the binary test format needed for the Verilator simulator
infrastructure, and then finally run the test through the compiled NVDLA
model.  On an Intel Core i5-6500, the <code class="docutils literal notranslate"><span class="pre">googlenet_conv2_3x3_int16</span></code> test
runs about 98,000 cycles in about 8 minutes.</p>
<p>The Verilated testbench is compatible with all of the traces that are in the
<code class="docutils literal notranslate"><span class="pre">traceplayer</span></code> directory.</p>
</div>
<div class="section" id="testbench-design">
<h4>Testbench design<a class="headerlink" href="#testbench-design" title="Permalink to this headline">¶</a></h4>
<p>The Verilator testbench is implemented in the <code class="docutils literal notranslate"><span class="pre">verif/verilator/nvdla.cpp</span></code>
file.  It instantiates one instance of the <code class="docutils literal notranslate"><span class="pre">VNV_nvdla</span></code> module, and wires
up the CSB interface to a simulated stimulus, and each of the memory
interfaces to simulated responders.  The timing of the trace is managed by
the simulated CSB master, and the main loop handles “external events” (i.e.,
non-CSB events, such as waiting for an interrupt, or loading data into or
checking data from a simulated AXI memory).</p>
</div>
</div>
</div>
</div>


        </div>
        <div class="col-xs-12 col-md-3">
          
      <div class="sphinxsidebar" role="navigation" aria-label="main navigation">
        <div class="sphinxsidebarwrapper">
  <h3><a href="../../contents.html">Table of Contents</a></h3>
  <ul>
<li><a class="reference internal" href="#">Integrator’s Manual</a><ul>
<li><a class="reference internal" href="#introduction">Introduction</a></li>
<li><a class="reference internal" href="#quick-start">Quick-Start</a></li>
<li><a class="reference internal" href="#hardware-system-interface">Hardware System Interface</a><ul>
<li><a class="reference internal" href="#overview">Overview</a></li>
<li><a class="reference internal" href="#system-diagram">System Diagram</a></li>
<li><a class="reference internal" href="#interfaces">Interfaces</a><ul>
<li><a class="reference internal" href="#clock-and-reset-interface">Clock and reset interface</a></li>
<li><a class="reference internal" href="#system-data-interfaces-dbbif-and-sramif">System Data Interfaces (DBBIF and SRAMIF)</a></li>
<li><a class="reference internal" href="#configuration-interface">Configuration Interface</a></li>
<li><a class="reference internal" href="#power-control">Power control</a></li>
<li><a class="reference internal" href="#dft">DFT</a></li>
</ul>
</li>
</ul>
</li>
<li><a class="reference internal" href="#environment-setup">Environment Setup</a></li>
<li><a class="reference internal" href="#tree-build">Tree Build</a><ul>
<li><a class="reference internal" href="#version-control-usage">Version control usage</a></li>
</ul>
</li>
<li><a class="reference internal" href="#performance-model">Performance Model</a></li>
<li><a class="reference internal" href="#designware-components">Designware Components</a></li>
<li><a class="reference internal" href="#library-cells">Library Cells</a><ul>
<li><a class="reference internal" href="#synchronizers">Synchronizers</a></li>
<li><a class="reference internal" href="#memories-sram">Memories (SRAM)</a><ul>
<li><a class="reference internal" href="#ramdp-dual-port-sram">RAMDP: Dual-Port SRAM</a></li>
<li><a class="reference internal" href="#rampdp-pseudo-dual-port-sram">RAMPDP: Pseudo-Dual Port SRAM</a></li>
</ul>
</li>
</ul>
</li>
<li><a class="reference internal" href="#synthesis">Synthesis</a><ul>
<li><a class="reference internal" href="#id5">Overview</a></li>
<li><a class="reference internal" href="#directory-structure">Directory structure</a></li>
<li><a class="reference internal" href="#requirements">Requirements</a></li>
<li><a class="reference internal" href="#synthesis-configuration">Synthesis Configuration</a></li>
<li><a class="reference internal" href="#synthesis-constraints">Synthesis constraints</a><ul>
<li><a class="reference internal" href="#clock-constraints">Clock Constraints</a></li>
<li><a class="reference internal" href="#clock-gate-enable-path-over-constraining">Clock Gate Enable Path Over constraining</a></li>
<li><a class="reference internal" href="#physical-constraints">Physical Constraints</a></li>
</ul>
</li>
<li><a class="reference internal" href="#running-synthesis">Running synthesis</a><ul>
<li><a class="reference internal" href="#running-non-physical-synthesis-wireload-models">Running Non-physical synthesis (Wireload Models)</a></li>
<li><a class="reference internal" href="#running-physical-synthesis">Running physical synthesis</a></li>
<li><a class="reference internal" href="#restoring-a-design-database">Restoring a design database</a></li>
</ul>
</li>
<li><a class="reference internal" href="#synthesis-outputs">Synthesis outputs</a></li>
</ul>
</li>
<li><a class="reference internal" href="#testbench-traces">Testbench &amp; Traces</a><ul>
<li><a class="reference internal" href="#tests">Tests</a></li>
<li><a class="reference internal" href="#basic-sanity-tests">Basic sanity tests</a></li>
<li><a class="reference internal" href="#short-single-function-tests-using-dbb">Short single function tests using dbb</a></li>
<li><a class="reference internal" href="#long-layer-tests">Long layer tests</a></li>
<li><a class="reference internal" href="#test-format">Test Format</a><ul>
<li><a class="reference internal" href="#hardware-config-read-write-commands">Hardware Config Read/Write Commands</a></li>
<li><a class="reference internal" href="#memory-read-write-commands">Memory Read/Write Commands</a></li>
<li><a class="reference internal" href="#memory-load-dump-command">Memory Load/Dump Command</a></li>
<li><a class="reference internal" href="#interrupt-wait-command">Interrupt Wait Command</a></li>
</ul>
</li>
<li><a class="reference internal" href="#reference-simulation-testbench">Reference Simulation Testbench</a><ul>
<li><a class="reference internal" href="#csb-master-trace-player">CSB Master Trace Player</a></li>
<li><a class="reference internal" href="#dbbif-slave-agent">DBBIF Slave Agent</a></li>
<li><a class="reference internal" href="#cvsram-slave-agent">CVSRAM Slave Agent</a></li>
<li><a class="reference internal" href="#memory-stub">Memory Stub</a></li>
<li><a class="reference internal" href="#running-a-test-using-make">Running a Test (using make)</a></li>
<li><a class="reference internal" href="#makefile-run-options">Makefile Run Options</a></li>
<li><a class="reference internal" href="#makefile-config">Makefile Config</a></li>
<li><a class="reference internal" href="#test-success">Test Success</a></li>
<li><a class="reference internal" href="#success-via-looking-at-logfile">Success Via Looking At Logfile</a></li>
<li><a class="reference internal" href="#runtime-configuration">Runtime Configuration</a></li>
</ul>
</li>
<li><a class="reference internal" href="#verilator-testbench">Verilator Testbench</a><ul>
<li><a class="reference internal" href="#setting-up">Setting up</a></li>
<li><a class="reference internal" href="#running-a-test">Running a test</a></li>
<li><a class="reference internal" href="#testbench-design">Testbench design</a></li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
</ul>

  <h4>Previous topic</h4>
  <p class="topless"><a href="../format.html"
                        title="previous chapter">In-memory data formats</a></p>
  <h4>Next topic</h4>
  <p class="topless"><a href="ias/precision.html"
                        title="next chapter">Precision Preservation</a></p>
  <div role="note" aria-label="source link">
    <h3>This Page</h3>
    <ul class="this-page-menu">
      <li><a href="../../_sources/hw/v1/integration_guide.rst.txt"
            rel="nofollow">Show Source</a></li>
    </ul>
   </div>
<div id="searchbox" style="display: none" role="search">
  <h3 id="searchlabel">Quick search</h3>
    <div class="searchformwrapper">
    <form class="search" action="../../search.html" method="get">
      <input type="text" name="q" aria-labelledby="searchlabel" />
      <input type="submit" value="Go" />
    </form>
    </div>
</div>
<script>$('#searchbox').show(0);</script>
        </div>
      </div>
        </div>
      </div>
    </div>
  </div>
    <div class="related" role="navigation" aria-label="related navigation">
      <div class="container">
      <div class="row">
      <h3>Navigation</h3>
      <ul>
        <li class="right first">
          <a href="ias/precision.html" title="Precision Preservation"
             >next</a></li>
        <li class="right">
          <a href="../format.html" title="In-memory data formats"
             >previous</a> |</li>
        <li class="nav-item nav-item-0"><a href="../../index.html">NVDLA Open Source Project</a>&#187;</li>
        <li class="nav-item nav-item-1"><a href="../../contents.html">Documentation</a>&#187;</li>
          <li class="nav-item nav-item-2"><a href="../contents.html" >Hardware Manual</a>&#187;</li> 
      </ul>
      </div>
      </div>
    </div>
<div class="footer" role="contentinfo">
<div class="container">
<div class="row">
&#169; <a
href="../../copyright.html">Copyright</a> 2018 - 2024, NVIDIA Corporation.
<a href="https://www.nvidia.com/object/legal_info.html">Legal Information.</a>
<a href="https://www.nvidia.com/object/privacy_policy.html">Privacy Policy.</a>
Created using <a href="https://www.sphinx-doc.org/">Sphinx</a> 3.5.4.
</div>
</div>
</div>
<script type="text/javascript">_satellite.pageBottom();</script>
  </body>
</html>